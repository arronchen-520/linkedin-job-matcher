var background=function(){"use strict";var yr,_r;function vr(r){return r==null||typeof r=="function"?{main:r}:r}var E;(function(r){r.assertEqual=n=>n;function e(n){}r.assertIs=e;function t(n){throw new Error}r.assertNever=t,r.arrayToEnum=n=>{const i={};for(const a of n)i[a]=a;return i},r.getValidEnumValues=n=>{const i=r.objectKeys(n).filter(o=>typeof n[n[o]]!="number"),a={};for(const o of i)a[o]=n[o];return r.objectValues(a)},r.objectValues=n=>r.objectKeys(n).map(function(i){return n[i]}),r.objectKeys=typeof Object.keys=="function"?n=>Object.keys(n):n=>{const i=[];for(const a in n)Object.prototype.hasOwnProperty.call(n,a)&&i.push(a);return i},r.find=(n,i)=>{for(const a of n)if(i(a))return a},r.isInteger=typeof Number.isInteger=="function"?n=>Number.isInteger(n):n=>typeof n=="number"&&isFinite(n)&&Math.floor(n)===n;function s(n,i=" | "){return n.map(a=>typeof a=="string"?`'${a}'`:a).join(i)}r.joinValues=s,r.jsonStringifyReplacer=(n,i)=>typeof i=="bigint"?i.toString():i})(E||(E={}));var jt;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(jt||(jt={}));const m=E.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),X=r=>{switch(typeof r){case"undefined":return m.undefined;case"string":return m.string;case"number":return isNaN(r)?m.nan:m.number;case"boolean":return m.boolean;case"function":return m.function;case"bigint":return m.bigint;case"symbol":return m.symbol;case"object":return Array.isArray(r)?m.array:r===null?m.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?m.promise:typeof Map<"u"&&r instanceof Map?m.map:typeof Set<"u"&&r instanceof Set?m.set:typeof Date<"u"&&r instanceof Date?m.date:m.object;default:return m.unknown}},f=E.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),wr=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:");class F extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=s=>{this.issues=[...this.issues,s]},this.addIssues=(s=[])=>{this.issues=[...this.issues,...s]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(i){return i.message},s={_errors:[]},n=i=>{for(const a of i.issues)if(a.code==="invalid_union")a.unionErrors.map(n);else if(a.code==="invalid_return_type")n(a.returnTypeError);else if(a.code==="invalid_arguments")n(a.argumentsError);else if(a.path.length===0)s._errors.push(t(a));else{let o=s,c=0;for(;c<a.path.length;){const l=a.path[c];c===a.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(t(a))):o[l]=o[l]||{_errors:[]},o=o[l],c++}}};return n(this),s}static assert(e){if(!(e instanceof F))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,E.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},s=[];for(const n of this.issues)n.path.length>0?(t[n.path[0]]=t[n.path[0]]||[],t[n.path[0]].push(e(n))):s.push(e(n));return{formErrors:s,fieldErrors:t}}get formErrors(){return this.flatten()}}F.create=r=>new F(r);const be=(r,e)=>{let t;switch(r.code){case f.invalid_type:r.received===m.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case f.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,E.jsonStringifyReplacer)}`;break;case f.unrecognized_keys:t=`Unrecognized key(s) in object: ${E.joinValues(r.keys,", ")}`;break;case f.invalid_union:t="Invalid input";break;case f.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${E.joinValues(r.options)}`;break;case f.invalid_enum_value:t=`Invalid enum value. Expected ${E.joinValues(r.options)}, received '${r.received}'`;break;case f.invalid_arguments:t="Invalid function arguments";break;case f.invalid_return_type:t="Invalid function return type";break;case f.invalid_date:t="Invalid date";break;case f.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:E.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case f.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case f.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case f.custom:t="Invalid input";break;case f.invalid_intersection_types:t="Intersection results could not be merged";break;case f.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case f.not_finite:t="Number must be finite";break;default:t=e.defaultError,E.assertNever(r)}return{message:t}};let as=be;function br(r){as=r}function ct(){return as}const lt=r=>{const{data:e,path:t,errorMaps:s,issueData:n}=r,i=[...t,...n.path||[]],a={...n,path:i};if(n.message!==void 0)return{...n,path:i,message:n.message};let o="";const c=s.filter(l=>!!l).slice().reverse();for(const l of c)o=l(a,{data:e,defaultError:o}).message;return{...n,path:i,message:o}},kr=[];function g(r,e){const t=ct(),s=lt({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===be?void 0:be].filter(n=>!!n)});r.common.issues.push(s)}class I{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const s=[];for(const n of t){if(n.status==="aborted")return w;n.status==="dirty"&&e.dirty(),s.push(n.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,t){const s=[];for(const n of t){const i=await n.key,a=await n.value;s.push({key:i,value:a})}return I.mergeObjectSync(e,s)}static mergeObjectSync(e,t){const s={};for(const n of t){const{key:i,value:a}=n;if(i.status==="aborted"||a.status==="aborted")return w;i.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof a.value<"u"||n.alwaysSet)&&(s[i.value]=a.value)}return{status:e.value,value:s}}}const w=Object.freeze({status:"aborted"}),ke=r=>({status:"dirty",value:r}),D=r=>({status:"valid",value:r}),Pt=r=>r.status==="aborted",Ct=r=>r.status==="dirty",he=r=>r.status==="valid",Ue=r=>typeof Promise<"u"&&r instanceof Promise;function ut(r,e,t,s){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(r)}function os(r,e,t,s,n){if(typeof e=="function"?r!==e||!0:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(r,t),t}typeof SuppressedError=="function"&&SuppressedError;var _;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(_||(_={}));var Me,Be;class H{constructor(e,t,s,n){this._cachedPath=[],this.parent=e,this.data=t,this._path=s,this._key=n}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const cs=(r,e)=>{if(he(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new F(r.common.issues);return this._error=t,this._error}}};function k(r){if(!r)return{};const{errorMap:e,invalid_type_error:t,required_error:s,description:n}=r;if(e&&(t||s))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:n}:{errorMap:(a,o)=>{var c,l;const{message:u}=r;return a.code==="invalid_enum_value"?{message:u??o.defaultError}:typeof o.data>"u"?{message:(c=u??s)!==null&&c!==void 0?c:o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:(l=u??t)!==null&&l!==void 0?l:o.defaultError}},description:n}}class S{get description(){return this._def.description}_getType(e){return X(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:X(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new I,ctx:{common:e.parent.common,data:e.data,parsedType:X(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Ue(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const s=this.safeParse(e,t);if(s.success)return s.data;throw s.error}safeParse(e,t){var s;const n={common:{issues:[],async:(s=t==null?void 0:t.async)!==null&&s!==void 0?s:!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:X(e)},i=this._parseSync({data:e,path:n.path,parent:n});return cs(n,i)}"~validate"(e){var t,s;const n={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:X(e)};if(!this["~standard"].async)try{const i=this._parseSync({data:e,path:[],parent:n});return he(i)?{value:i.value}:{issues:n.common.issues}}catch(i){!((s=(t=i==null?void 0:i.message)===null||t===void 0?void 0:t.toLowerCase())===null||s===void 0)&&s.includes("encountered")&&(this["~standard"].async=!0),n.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:n}).then(i=>he(i)?{value:i.value}:{issues:n.common.issues})}async parseAsync(e,t){const s=await this.safeParseAsync(e,t);if(s.success)return s.data;throw s.error}async safeParseAsync(e,t){const s={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:X(e)},n=this._parse({data:e,path:s.path,parent:s}),i=await(Ue(n)?n:Promise.resolve(n));return cs(s,i)}refine(e,t){const s=n=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(n):t;return this._refinement((n,i)=>{const a=e(n),o=()=>i.addIssue({code:f.custom,...s(n)});return typeof Promise<"u"&&a instanceof Promise?a.then(c=>c?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,t){return this._refinement((s,n)=>e(s)?!0:(n.addIssue(typeof t=="function"?t(s,n):t),!1))}_refinement(e){return new G({schema:this,typeName:v.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return K.create(this,this._def)}nullable(){return oe.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return V.create(this)}promise(){return Ae.create(this,this._def)}or(e){return qe.create([this,e],this._def)}and(e){return Ve.create(this,e,this._def)}transform(e){return new G({...k(this._def),schema:this,typeName:v.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new Ke({...k(this._def),innerType:this,defaultValue:t,typeName:v.ZodDefault})}brand(){return new $t({typeName:v.ZodBranded,type:this,...k(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new Qe({...k(this._def),innerType:this,catchValue:t,typeName:v.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Ye.create(this,e)}readonly(){return Xe.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Sr=/^c[^\s-]{8,}$/i,Tr=/^[0-9a-z]+$/,xr=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Ar=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Er=/^[a-z0-9_-]{21}$/i,Or=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,jr=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Pr=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Cr="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let Rt;const Rr=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Ir=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,$r=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Lr=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Nr=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Dr=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,ls="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Ur=new RegExp(`^${ls}$`);function us(r){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`),e}function Mr(r){return new RegExp(`^${us(r)}$`)}function ds(r){let e=`${ls}T${us(r)}`;const t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function Br(r,e){return!!((e==="v4"||!e)&&Rr.test(r)||(e==="v6"||!e)&&$r.test(r))}function Zr(r,e){if(!Or.test(r))return!1;try{const[t]=r.split("."),s=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),n=JSON.parse(atob(s));return!(typeof n!="object"||n===null||!n.typ||!n.alg||e&&n.alg!==e)}catch{return!1}}function Fr(r,e){return!!((e==="v4"||!e)&&Ir.test(r)||(e==="v6"||!e)&&Lr.test(r))}class q extends S{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==m.string){const i=this._getOrReturnCtx(e);return g(i,{code:f.invalid_type,expected:m.string,received:i.parsedType}),w}const s=new I;let n;for(const i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(n=this._getOrReturnCtx(e,n),g(n,{code:f.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),s.dirty());else if(i.kind==="max")e.data.length>i.value&&(n=this._getOrReturnCtx(e,n),g(n,{code:f.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),s.dirty());else if(i.kind==="length"){const a=e.data.length>i.value,o=e.data.length<i.value;(a||o)&&(n=this._getOrReturnCtx(e,n),a?g(n,{code:f.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):o&&g(n,{code:f.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),s.dirty())}else if(i.kind==="email")Pr.test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"email",code:f.invalid_string,message:i.message}),s.dirty());else if(i.kind==="emoji")Rt||(Rt=new RegExp(Cr,"u")),Rt.test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"emoji",code:f.invalid_string,message:i.message}),s.dirty());else if(i.kind==="uuid")Ar.test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"uuid",code:f.invalid_string,message:i.message}),s.dirty());else if(i.kind==="nanoid")Er.test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"nanoid",code:f.invalid_string,message:i.message}),s.dirty());else if(i.kind==="cuid")Sr.test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"cuid",code:f.invalid_string,message:i.message}),s.dirty());else if(i.kind==="cuid2")Tr.test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"cuid2",code:f.invalid_string,message:i.message}),s.dirty());else if(i.kind==="ulid")xr.test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"ulid",code:f.invalid_string,message:i.message}),s.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),g(n,{validation:"url",code:f.invalid_string,message:i.message}),s.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"regex",code:f.invalid_string,message:i.message}),s.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(n=this._getOrReturnCtx(e,n),g(n,{code:f.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),s.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(n=this._getOrReturnCtx(e,n),g(n,{code:f.invalid_string,validation:{startsWith:i.value},message:i.message}),s.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(n=this._getOrReturnCtx(e,n),g(n,{code:f.invalid_string,validation:{endsWith:i.value},message:i.message}),s.dirty()):i.kind==="datetime"?ds(i).test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{code:f.invalid_string,validation:"datetime",message:i.message}),s.dirty()):i.kind==="date"?Ur.test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{code:f.invalid_string,validation:"date",message:i.message}),s.dirty()):i.kind==="time"?Mr(i).test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{code:f.invalid_string,validation:"time",message:i.message}),s.dirty()):i.kind==="duration"?jr.test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"duration",code:f.invalid_string,message:i.message}),s.dirty()):i.kind==="ip"?Br(e.data,i.version)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"ip",code:f.invalid_string,message:i.message}),s.dirty()):i.kind==="jwt"?Zr(e.data,i.alg)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"jwt",code:f.invalid_string,message:i.message}),s.dirty()):i.kind==="cidr"?Fr(e.data,i.version)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"cidr",code:f.invalid_string,message:i.message}),s.dirty()):i.kind==="base64"?Nr.test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"base64",code:f.invalid_string,message:i.message}),s.dirty()):i.kind==="base64url"?Dr.test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"base64url",code:f.invalid_string,message:i.message}),s.dirty()):E.assertNever(i);return{status:s.value,value:e.data}}_regex(e,t,s){return this.refinement(n=>e.test(n),{validation:t,code:f.invalid_string,..._.errToObj(s)})}_addCheck(e){return new q({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",..._.errToObj(e)})}url(e){return this._addCheck({kind:"url",..._.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",..._.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",..._.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",..._.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",..._.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",..._.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",..._.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",..._.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",..._.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",..._.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",..._.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",..._.errToObj(e)})}datetime(e){var t,s;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(t=e==null?void 0:e.offset)!==null&&t!==void 0?t:!1,local:(s=e==null?void 0:e.local)!==null&&s!==void 0?s:!1,..._.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,..._.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",..._.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,..._.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,..._.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,..._.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,..._.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,..._.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,..._.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,..._.errToObj(t)})}nonempty(e){return this.min(1,_.errToObj(e))}trim(){return new q({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new q({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new q({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}q.create=r=>{var e;return new q({checks:[],typeName:v.ZodString,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...k(r)})};function zr(r,e){const t=(r.toString().split(".")[1]||"").length,s=(e.toString().split(".")[1]||"").length,n=t>s?t:s,i=parseInt(r.toFixed(n).replace(".","")),a=parseInt(e.toFixed(n).replace(".",""));return i%a/Math.pow(10,n)}class ne extends S{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==m.number){const i=this._getOrReturnCtx(e);return g(i,{code:f.invalid_type,expected:m.number,received:i.parsedType}),w}let s;const n=new I;for(const i of this._def.checks)i.kind==="int"?E.isInteger(e.data)||(s=this._getOrReturnCtx(e,s),g(s,{code:f.invalid_type,expected:"integer",received:"float",message:i.message}),n.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(s=this._getOrReturnCtx(e,s),g(s,{code:f.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),n.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(s=this._getOrReturnCtx(e,s),g(s,{code:f.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),n.dirty()):i.kind==="multipleOf"?zr(e.data,i.value)!==0&&(s=this._getOrReturnCtx(e,s),g(s,{code:f.not_multiple_of,multipleOf:i.value,message:i.message}),n.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(s=this._getOrReturnCtx(e,s),g(s,{code:f.not_finite,message:i.message}),n.dirty()):E.assertNever(i);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,_.toString(t))}gt(e,t){return this.setLimit("min",e,!1,_.toString(t))}lte(e,t){return this.setLimit("max",e,!0,_.toString(t))}lt(e,t){return this.setLimit("max",e,!1,_.toString(t))}setLimit(e,t,s,n){return new ne({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:_.toString(n)}]})}_addCheck(e){return new ne({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:_.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:_.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:_.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:_.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:_.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:_.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:_.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:_.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:_.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&E.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const s of this._def.checks){if(s.kind==="finite"||s.kind==="int"||s.kind==="multipleOf")return!0;s.kind==="min"?(t===null||s.value>t)&&(t=s.value):s.kind==="max"&&(e===null||s.value<e)&&(e=s.value)}return Number.isFinite(t)&&Number.isFinite(e)}}ne.create=r=>new ne({checks:[],typeName:v.ZodNumber,coerce:(r==null?void 0:r.coerce)||!1,...k(r)});class ie extends S{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==m.bigint)return this._getInvalidInput(e);let s;const n=new I;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(s=this._getOrReturnCtx(e,s),g(s,{code:f.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),n.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(s=this._getOrReturnCtx(e,s),g(s,{code:f.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),n.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(s=this._getOrReturnCtx(e,s),g(s,{code:f.not_multiple_of,multipleOf:i.value,message:i.message}),n.dirty()):E.assertNever(i);return{status:n.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return g(t,{code:f.invalid_type,expected:m.bigint,received:t.parsedType}),w}gte(e,t){return this.setLimit("min",e,!0,_.toString(t))}gt(e,t){return this.setLimit("min",e,!1,_.toString(t))}lte(e,t){return this.setLimit("max",e,!0,_.toString(t))}lt(e,t){return this.setLimit("max",e,!1,_.toString(t))}setLimit(e,t,s,n){return new ie({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:_.toString(n)}]})}_addCheck(e){return new ie({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:_.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:_.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:_.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:_.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:_.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}ie.create=r=>{var e;return new ie({checks:[],typeName:v.ZodBigInt,coerce:(e=r==null?void 0:r.coerce)!==null&&e!==void 0?e:!1,...k(r)})};class Ze extends S{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==m.boolean){const s=this._getOrReturnCtx(e);return g(s,{code:f.invalid_type,expected:m.boolean,received:s.parsedType}),w}return D(e.data)}}Ze.create=r=>new Ze({typeName:v.ZodBoolean,coerce:(r==null?void 0:r.coerce)||!1,...k(r)});class fe extends S{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==m.date){const i=this._getOrReturnCtx(e);return g(i,{code:f.invalid_type,expected:m.date,received:i.parsedType}),w}if(isNaN(e.data.getTime())){const i=this._getOrReturnCtx(e);return g(i,{code:f.invalid_date}),w}const s=new I;let n;for(const i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(n=this._getOrReturnCtx(e,n),g(n,{code:f.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),s.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(n=this._getOrReturnCtx(e,n),g(n,{code:f.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),s.dirty()):E.assertNever(i);return{status:s.value,value:new Date(e.data.getTime())}}_addCheck(e){return new fe({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:_.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:_.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}fe.create=r=>new fe({checks:[],coerce:(r==null?void 0:r.coerce)||!1,typeName:v.ZodDate,...k(r)});class dt extends S{_parse(e){if(this._getType(e)!==m.symbol){const s=this._getOrReturnCtx(e);return g(s,{code:f.invalid_type,expected:m.symbol,received:s.parsedType}),w}return D(e.data)}}dt.create=r=>new dt({typeName:v.ZodSymbol,...k(r)});class Fe extends S{_parse(e){if(this._getType(e)!==m.undefined){const s=this._getOrReturnCtx(e);return g(s,{code:f.invalid_type,expected:m.undefined,received:s.parsedType}),w}return D(e.data)}}Fe.create=r=>new Fe({typeName:v.ZodUndefined,...k(r)});class ze extends S{_parse(e){if(this._getType(e)!==m.null){const s=this._getOrReturnCtx(e);return g(s,{code:f.invalid_type,expected:m.null,received:s.parsedType}),w}return D(e.data)}}ze.create=r=>new ze({typeName:v.ZodNull,...k(r)});class Se extends S{constructor(){super(...arguments),this._any=!0}_parse(e){return D(e.data)}}Se.create=r=>new Se({typeName:v.ZodAny,...k(r)});class pe extends S{constructor(){super(...arguments),this._unknown=!0}_parse(e){return D(e.data)}}pe.create=r=>new pe({typeName:v.ZodUnknown,...k(r)});class ee extends S{_parse(e){const t=this._getOrReturnCtx(e);return g(t,{code:f.invalid_type,expected:m.never,received:t.parsedType}),w}}ee.create=r=>new ee({typeName:v.ZodNever,...k(r)});class ht extends S{_parse(e){if(this._getType(e)!==m.undefined){const s=this._getOrReturnCtx(e);return g(s,{code:f.invalid_type,expected:m.void,received:s.parsedType}),w}return D(e.data)}}ht.create=r=>new ht({typeName:v.ZodVoid,...k(r)});class V extends S{_parse(e){const{ctx:t,status:s}=this._processInputParams(e),n=this._def;if(t.parsedType!==m.array)return g(t,{code:f.invalid_type,expected:m.array,received:t.parsedType}),w;if(n.exactLength!==null){const a=t.data.length>n.exactLength.value,o=t.data.length<n.exactLength.value;(a||o)&&(g(t,{code:a?f.too_big:f.too_small,minimum:o?n.exactLength.value:void 0,maximum:a?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),s.dirty())}if(n.minLength!==null&&t.data.length<n.minLength.value&&(g(t,{code:f.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),s.dirty()),n.maxLength!==null&&t.data.length>n.maxLength.value&&(g(t,{code:f.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),s.dirty()),t.common.async)return Promise.all([...t.data].map((a,o)=>n.type._parseAsync(new H(t,a,t.path,o)))).then(a=>I.mergeArray(s,a));const i=[...t.data].map((a,o)=>n.type._parseSync(new H(t,a,t.path,o)));return I.mergeArray(s,i)}get element(){return this._def.type}min(e,t){return new V({...this._def,minLength:{value:e,message:_.toString(t)}})}max(e,t){return new V({...this._def,maxLength:{value:e,message:_.toString(t)}})}length(e,t){return new V({...this._def,exactLength:{value:e,message:_.toString(t)}})}nonempty(e){return this.min(1,e)}}V.create=(r,e)=>new V({type:r,minLength:null,maxLength:null,exactLength:null,typeName:v.ZodArray,...k(e)});function Te(r){if(r instanceof P){const e={};for(const t in r.shape){const s=r.shape[t];e[t]=K.create(Te(s))}return new P({...r._def,shape:()=>e})}else return r instanceof V?new V({...r._def,type:Te(r.element)}):r instanceof K?K.create(Te(r.unwrap())):r instanceof oe?oe.create(Te(r.unwrap())):r instanceof W?W.create(r.items.map(e=>Te(e))):r}class P extends S{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=E.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==m.object){const l=this._getOrReturnCtx(e);return g(l,{code:f.invalid_type,expected:m.object,received:l.parsedType}),w}const{status:s,ctx:n}=this._processInputParams(e),{shape:i,keys:a}=this._getCached(),o=[];if(!(this._def.catchall instanceof ee&&this._def.unknownKeys==="strip"))for(const l in n.data)a.includes(l)||o.push(l);const c=[];for(const l of a){const u=i[l],h=n.data[l];c.push({key:{status:"valid",value:l},value:u._parse(new H(n,h,n.path,l)),alwaysSet:l in n.data})}if(this._def.catchall instanceof ee){const l=this._def.unknownKeys;if(l==="passthrough")for(const u of o)c.push({key:{status:"valid",value:u},value:{status:"valid",value:n.data[u]}});else if(l==="strict")o.length>0&&(g(n,{code:f.unrecognized_keys,keys:o}),s.dirty());else if(l!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const l=this._def.catchall;for(const u of o){const h=n.data[u];c.push({key:{status:"valid",value:u},value:l._parse(new H(n,h,n.path,u)),alwaysSet:u in n.data})}}return n.common.async?Promise.resolve().then(async()=>{const l=[];for(const u of c){const h=await u.key,p=await u.value;l.push({key:h,value:p,alwaysSet:u.alwaysSet})}return l}).then(l=>I.mergeObjectSync(s,l)):I.mergeObjectSync(s,c)}get shape(){return this._def.shape()}strict(e){return _.errToObj,new P({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,s)=>{var n,i,a,o;const c=(a=(i=(n=this._def).errorMap)===null||i===void 0?void 0:i.call(n,t,s).message)!==null&&a!==void 0?a:s.defaultError;return t.code==="unrecognized_keys"?{message:(o=_.errToObj(e).message)!==null&&o!==void 0?o:c}:{message:c}}}:{}})}strip(){return new P({...this._def,unknownKeys:"strip"})}passthrough(){return new P({...this._def,unknownKeys:"passthrough"})}extend(e){return new P({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new P({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:v.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new P({...this._def,catchall:e})}pick(e){const t={};return E.objectKeys(e).forEach(s=>{e[s]&&this.shape[s]&&(t[s]=this.shape[s])}),new P({...this._def,shape:()=>t})}omit(e){const t={};return E.objectKeys(this.shape).forEach(s=>{e[s]||(t[s]=this.shape[s])}),new P({...this._def,shape:()=>t})}deepPartial(){return Te(this)}partial(e){const t={};return E.objectKeys(this.shape).forEach(s=>{const n=this.shape[s];e&&!e[s]?t[s]=n:t[s]=n.optional()}),new P({...this._def,shape:()=>t})}required(e){const t={};return E.objectKeys(this.shape).forEach(s=>{if(e&&!e[s])t[s]=this.shape[s];else{let i=this.shape[s];for(;i instanceof K;)i=i._def.innerType;t[s]=i}}),new P({...this._def,shape:()=>t})}keyof(){return hs(E.objectKeys(this.shape))}}P.create=(r,e)=>new P({shape:()=>r,unknownKeys:"strip",catchall:ee.create(),typeName:v.ZodObject,...k(e)}),P.strictCreate=(r,e)=>new P({shape:()=>r,unknownKeys:"strict",catchall:ee.create(),typeName:v.ZodObject,...k(e)}),P.lazycreate=(r,e)=>new P({shape:r,unknownKeys:"strip",catchall:ee.create(),typeName:v.ZodObject,...k(e)});class qe extends S{_parse(e){const{ctx:t}=this._processInputParams(e),s=this._def.options;function n(i){for(const o of i)if(o.result.status==="valid")return o.result;for(const o of i)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const a=i.map(o=>new F(o.ctx.common.issues));return g(t,{code:f.invalid_union,unionErrors:a}),w}if(t.common.async)return Promise.all(s.map(async i=>{const a={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:a}),ctx:a}})).then(n);{let i;const a=[];for(const c of s){const l={...t,common:{...t.common,issues:[]},parent:null},u=c._parseSync({data:t.data,path:t.path,parent:l});if(u.status==="valid")return u;u.status==="dirty"&&!i&&(i={result:u,ctx:l}),l.common.issues.length&&a.push(l.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;const o=a.map(c=>new F(c));return g(t,{code:f.invalid_union,unionErrors:o}),w}}get options(){return this._def.options}}qe.create=(r,e)=>new qe({options:r,typeName:v.ZodUnion,...k(e)});const te=r=>r instanceof Je?te(r.schema):r instanceof G?te(r.innerType()):r instanceof He?[r.value]:r instanceof ae?r.options:r instanceof We?E.objectValues(r.enum):r instanceof Ke?te(r._def.innerType):r instanceof Fe?[void 0]:r instanceof ze?[null]:r instanceof K?[void 0,...te(r.unwrap())]:r instanceof oe?[null,...te(r.unwrap())]:r instanceof $t||r instanceof Xe?te(r.unwrap()):r instanceof Qe?te(r._def.innerType):[];class ft extends S{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==m.object)return g(t,{code:f.invalid_type,expected:m.object,received:t.parsedType}),w;const s=this.discriminator,n=t.data[s],i=this.optionsMap.get(n);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(g(t,{code:f.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[s]}),w)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,s){const n=new Map;for(const i of t){const a=te(i.shape[e]);if(!a.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of a){if(n.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);n.set(o,i)}}return new ft({typeName:v.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:n,...k(s)})}}function It(r,e){const t=X(r),s=X(e);if(r===e)return{valid:!0,data:r};if(t===m.object&&s===m.object){const n=E.objectKeys(e),i=E.objectKeys(r).filter(o=>n.indexOf(o)!==-1),a={...r,...e};for(const o of i){const c=It(r[o],e[o]);if(!c.valid)return{valid:!1};a[o]=c.data}return{valid:!0,data:a}}else if(t===m.array&&s===m.array){if(r.length!==e.length)return{valid:!1};const n=[];for(let i=0;i<r.length;i++){const a=r[i],o=e[i],c=It(a,o);if(!c.valid)return{valid:!1};n.push(c.data)}return{valid:!0,data:n}}else return t===m.date&&s===m.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}class Ve extends S{_parse(e){const{status:t,ctx:s}=this._processInputParams(e),n=(i,a)=>{if(Pt(i)||Pt(a))return w;const o=It(i.value,a.value);return o.valid?((Ct(i)||Ct(a))&&t.dirty(),{status:t.value,value:o.data}):(g(s,{code:f.invalid_intersection_types}),w)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then(([i,a])=>n(i,a)):n(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}}Ve.create=(r,e,t)=>new Ve({left:r,right:e,typeName:v.ZodIntersection,...k(t)});class W extends S{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==m.array)return g(s,{code:f.invalid_type,expected:m.array,received:s.parsedType}),w;if(s.data.length<this._def.items.length)return g(s,{code:f.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),w;!this._def.rest&&s.data.length>this._def.items.length&&(g(s,{code:f.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const i=[...s.data].map((a,o)=>{const c=this._def.items[o]||this._def.rest;return c?c._parse(new H(s,a,s.path,o)):null}).filter(a=>!!a);return s.common.async?Promise.all(i).then(a=>I.mergeArray(t,a)):I.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new W({...this._def,rest:e})}}W.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new W({items:r,typeName:v.ZodTuple,rest:null,...k(e)})};class Ge extends S{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==m.object)return g(s,{code:f.invalid_type,expected:m.object,received:s.parsedType}),w;const n=[],i=this._def.keyType,a=this._def.valueType;for(const o in s.data)n.push({key:i._parse(new H(s,o,s.path,o)),value:a._parse(new H(s,s.data[o],s.path,o)),alwaysSet:o in s.data});return s.common.async?I.mergeObjectAsync(t,n):I.mergeObjectSync(t,n)}get element(){return this._def.valueType}static create(e,t,s){return t instanceof S?new Ge({keyType:e,valueType:t,typeName:v.ZodRecord,...k(s)}):new Ge({keyType:q.create(),valueType:e,typeName:v.ZodRecord,...k(t)})}}class pt extends S{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==m.map)return g(s,{code:f.invalid_type,expected:m.map,received:s.parsedType}),w;const n=this._def.keyType,i=this._def.valueType,a=[...s.data.entries()].map(([o,c],l)=>({key:n._parse(new H(s,o,s.path,[l,"key"])),value:i._parse(new H(s,c,s.path,[l,"value"]))}));if(s.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const c of a){const l=await c.key,u=await c.value;if(l.status==="aborted"||u.status==="aborted")return w;(l.status==="dirty"||u.status==="dirty")&&t.dirty(),o.set(l.value,u.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const c of a){const l=c.key,u=c.value;if(l.status==="aborted"||u.status==="aborted")return w;(l.status==="dirty"||u.status==="dirty")&&t.dirty(),o.set(l.value,u.value)}return{status:t.value,value:o}}}}pt.create=(r,e,t)=>new pt({valueType:e,keyType:r,typeName:v.ZodMap,...k(t)});class ge extends S{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==m.set)return g(s,{code:f.invalid_type,expected:m.set,received:s.parsedType}),w;const n=this._def;n.minSize!==null&&s.data.size<n.minSize.value&&(g(s,{code:f.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),t.dirty()),n.maxSize!==null&&s.data.size>n.maxSize.value&&(g(s,{code:f.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),t.dirty());const i=this._def.valueType;function a(c){const l=new Set;for(const u of c){if(u.status==="aborted")return w;u.status==="dirty"&&t.dirty(),l.add(u.value)}return{status:t.value,value:l}}const o=[...s.data.values()].map((c,l)=>i._parse(new H(s,c,s.path,l)));return s.common.async?Promise.all(o).then(c=>a(c)):a(o)}min(e,t){return new ge({...this._def,minSize:{value:e,message:_.toString(t)}})}max(e,t){return new ge({...this._def,maxSize:{value:e,message:_.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}ge.create=(r,e)=>new ge({valueType:r,minSize:null,maxSize:null,typeName:v.ZodSet,...k(e)});class xe extends S{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==m.function)return g(t,{code:f.invalid_type,expected:m.function,received:t.parsedType}),w;function s(o,c){return lt({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,ct(),be].filter(l=>!!l),issueData:{code:f.invalid_arguments,argumentsError:c}})}function n(o,c){return lt({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,ct(),be].filter(l=>!!l),issueData:{code:f.invalid_return_type,returnTypeError:c}})}const i={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof Ae){const o=this;return D(async function(...c){const l=new F([]),u=await o._def.args.parseAsync(c,i).catch(y=>{throw l.addIssue(s(c,y)),l}),h=await Reflect.apply(a,this,u);return await o._def.returns._def.type.parseAsync(h,i).catch(y=>{throw l.addIssue(n(h,y)),l})})}else{const o=this;return D(function(...c){const l=o._def.args.safeParse(c,i);if(!l.success)throw new F([s(c,l.error)]);const u=Reflect.apply(a,this,l.data),h=o._def.returns.safeParse(u,i);if(!h.success)throw new F([n(u,h.error)]);return h.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new xe({...this._def,args:W.create(e).rest(pe.create())})}returns(e){return new xe({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,s){return new xe({args:e||W.create([]).rest(pe.create()),returns:t||pe.create(),typeName:v.ZodFunction,...k(s)})}}class Je extends S{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Je.create=(r,e)=>new Je({getter:r,typeName:v.ZodLazy,...k(e)});class He extends S{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return g(t,{received:t.data,code:f.invalid_literal,expected:this._def.value}),w}return{status:"valid",value:e.data}}get value(){return this._def.value}}He.create=(r,e)=>new He({value:r,typeName:v.ZodLiteral,...k(e)});function hs(r,e){return new ae({values:r,typeName:v.ZodEnum,...k(e)})}class ae extends S{constructor(){super(...arguments),Me.set(this,void 0)}_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),s=this._def.values;return g(t,{expected:E.joinValues(s),received:t.parsedType,code:f.invalid_type}),w}if(ut(this,Me)||os(this,Me,new Set(this._def.values)),!ut(this,Me).has(e.data)){const t=this._getOrReturnCtx(e),s=this._def.values;return g(t,{received:t.data,code:f.invalid_enum_value,options:s}),w}return D(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return ae.create(e,{...this._def,...t})}exclude(e,t=this._def){return ae.create(this.options.filter(s=>!e.includes(s)),{...this._def,...t})}}Me=new WeakMap,ae.create=hs;class We extends S{constructor(){super(...arguments),Be.set(this,void 0)}_parse(e){const t=E.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(e);if(s.parsedType!==m.string&&s.parsedType!==m.number){const n=E.objectValues(t);return g(s,{expected:E.joinValues(n),received:s.parsedType,code:f.invalid_type}),w}if(ut(this,Be)||os(this,Be,new Set(E.getValidEnumValues(this._def.values))),!ut(this,Be).has(e.data)){const n=E.objectValues(t);return g(s,{received:s.data,code:f.invalid_enum_value,options:n}),w}return D(e.data)}get enum(){return this._def.values}}Be=new WeakMap,We.create=(r,e)=>new We({values:r,typeName:v.ZodNativeEnum,...k(e)});class Ae extends S{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==m.promise&&t.common.async===!1)return g(t,{code:f.invalid_type,expected:m.promise,received:t.parsedType}),w;const s=t.parsedType===m.promise?t.data:Promise.resolve(t.data);return D(s.then(n=>this._def.type.parseAsync(n,{path:t.path,errorMap:t.common.contextualErrorMap})))}}Ae.create=(r,e)=>new Ae({type:r,typeName:v.ZodPromise,...k(e)});class G extends S{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===v.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:s}=this._processInputParams(e),n=this._def.effect||null,i={addIssue:a=>{g(s,a),a.fatal?t.abort():t.dirty()},get path(){return s.path}};if(i.addIssue=i.addIssue.bind(i),n.type==="preprocess"){const a=n.transform(s.data,i);if(s.common.async)return Promise.resolve(a).then(async o=>{if(t.value==="aborted")return w;const c=await this._def.schema._parseAsync({data:o,path:s.path,parent:s});return c.status==="aborted"?w:c.status==="dirty"||t.value==="dirty"?ke(c.value):c});{if(t.value==="aborted")return w;const o=this._def.schema._parseSync({data:a,path:s.path,parent:s});return o.status==="aborted"?w:o.status==="dirty"||t.value==="dirty"?ke(o.value):o}}if(n.type==="refinement"){const a=o=>{const c=n.refinement(o,i);if(s.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(s.common.async===!1){const o=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return o.status==="aborted"?w:(o.status==="dirty"&&t.dirty(),a(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(o=>o.status==="aborted"?w:(o.status==="dirty"&&t.dirty(),a(o.value).then(()=>({status:t.value,value:o.value}))))}if(n.type==="transform")if(s.common.async===!1){const a=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!he(a))return a;const o=n.transform(a.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(a=>he(a)?Promise.resolve(n.transform(a.value,i)).then(o=>({status:t.value,value:o})):a);E.assertNever(n)}}G.create=(r,e,t)=>new G({schema:r,typeName:v.ZodEffects,effect:e,...k(t)}),G.createWithPreprocess=(r,e,t)=>new G({schema:e,effect:{type:"preprocess",transform:r},typeName:v.ZodEffects,...k(t)});class K extends S{_parse(e){return this._getType(e)===m.undefined?D(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}K.create=(r,e)=>new K({innerType:r,typeName:v.ZodOptional,...k(e)});class oe extends S{_parse(e){return this._getType(e)===m.null?D(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}oe.create=(r,e)=>new oe({innerType:r,typeName:v.ZodNullable,...k(e)});class Ke extends S{_parse(e){const{ctx:t}=this._processInputParams(e);let s=t.data;return t.parsedType===m.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Ke.create=(r,e)=>new Ke({innerType:r,typeName:v.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...k(e)});class Qe extends S{_parse(e){const{ctx:t}=this._processInputParams(e),s={...t,common:{...t.common,issues:[]}},n=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return Ue(n)?n.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new F(s.common.issues)},input:s.data})})):{status:"valid",value:n.status==="valid"?n.value:this._def.catchValue({get error(){return new F(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}}Qe.create=(r,e)=>new Qe({innerType:r,typeName:v.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...k(e)});class gt extends S{_parse(e){if(this._getType(e)!==m.nan){const s=this._getOrReturnCtx(e);return g(s,{code:f.invalid_type,expected:m.nan,received:s.parsedType}),w}return{status:"valid",value:e.data}}}gt.create=r=>new gt({typeName:v.ZodNaN,...k(r)});const qr=Symbol("zod_brand");class $t extends S{_parse(e){const{ctx:t}=this._processInputParams(e),s=t.data;return this._def.type._parse({data:s,path:t.path,parent:t})}unwrap(){return this._def.type}}class Ye extends S{_parse(e){const{status:t,ctx:s}=this._processInputParams(e);if(s.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return i.status==="aborted"?w:i.status==="dirty"?(t.dirty(),ke(i.value)):this._def.out._parseAsync({data:i.value,path:s.path,parent:s})})();{const n=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return n.status==="aborted"?w:n.status==="dirty"?(t.dirty(),{status:"dirty",value:n.value}):this._def.out._parseSync({data:n.value,path:s.path,parent:s})}}static create(e,t){return new Ye({in:e,out:t,typeName:v.ZodPipeline})}}class Xe extends S{_parse(e){const t=this._def.innerType._parse(e),s=n=>(he(n)&&(n.value=Object.freeze(n.value)),n);return Ue(t)?t.then(n=>s(n)):s(t)}unwrap(){return this._def.innerType}}Xe.create=(r,e)=>new Xe({innerType:r,typeName:v.ZodReadonly,...k(e)});function fs(r,e){const t=typeof r=="function"?r(e):typeof r=="string"?{message:r}:r;return typeof t=="string"?{message:t}:t}function ps(r,e={},t){return r?Se.create().superRefine((s,n)=>{var i,a;const o=r(s);if(o instanceof Promise)return o.then(c=>{var l,u;if(!c){const h=fs(e,s),p=(u=(l=h.fatal)!==null&&l!==void 0?l:t)!==null&&u!==void 0?u:!0;n.addIssue({code:"custom",...h,fatal:p})}});if(!o){const c=fs(e,s),l=(a=(i=c.fatal)!==null&&i!==void 0?i:t)!==null&&a!==void 0?a:!0;n.addIssue({code:"custom",...c,fatal:l})}}):Se.create()}const Vr={object:P.lazycreate};var v;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(v||(v={}));const Gr=(r,e={message:`Input not instance of ${r.name}`})=>ps(t=>t instanceof r,e),gs=q.create,ms=ne.create,Jr=gt.create,Hr=ie.create,ys=Ze.create,Wr=fe.create,Kr=dt.create,Qr=Fe.create,Yr=ze.create,Xr=Se.create,en=pe.create,tn=ee.create,sn=ht.create,rn=V.create,nn=P.create,an=P.strictCreate,on=qe.create,cn=ft.create,ln=Ve.create,un=W.create,dn=Ge.create,hn=pt.create,fn=ge.create,pn=xe.create,gn=Je.create,mn=He.create,yn=ae.create,_n=We.create,vn=Ae.create,_s=G.create,wn=K.create,bn=oe.create,kn=G.createWithPreprocess,Sn=Ye.create;var d=Object.freeze({__proto__:null,defaultErrorMap:be,setErrorMap:br,getErrorMap:ct,makeIssue:lt,EMPTY_PATH:kr,addIssueToContext:g,ParseStatus:I,INVALID:w,DIRTY:ke,OK:D,isAborted:Pt,isDirty:Ct,isValid:he,isAsync:Ue,get util(){return E},get objectUtil(){return jt},ZodParsedType:m,getParsedType:X,ZodType:S,datetimeRegex:ds,ZodString:q,ZodNumber:ne,ZodBigInt:ie,ZodBoolean:Ze,ZodDate:fe,ZodSymbol:dt,ZodUndefined:Fe,ZodNull:ze,ZodAny:Se,ZodUnknown:pe,ZodNever:ee,ZodVoid:ht,ZodArray:V,ZodObject:P,ZodUnion:qe,ZodDiscriminatedUnion:ft,ZodIntersection:Ve,ZodTuple:W,ZodRecord:Ge,ZodMap:pt,ZodSet:ge,ZodFunction:xe,ZodLazy:Je,ZodLiteral:He,ZodEnum:ae,ZodNativeEnum:We,ZodPromise:Ae,ZodEffects:G,ZodTransformer:G,ZodOptional:K,ZodNullable:oe,ZodDefault:Ke,ZodCatch:Qe,ZodNaN:gt,BRAND:qr,ZodBranded:$t,ZodPipeline:Ye,ZodReadonly:Xe,custom:ps,Schema:S,ZodSchema:S,late:Vr,get ZodFirstPartyTypeKind(){return v},coerce:{string:r=>q.create({...r,coerce:!0}),number:r=>ne.create({...r,coerce:!0}),boolean:r=>Ze.create({...r,coerce:!0}),bigint:r=>ie.create({...r,coerce:!0}),date:r=>fe.create({...r,coerce:!0})},any:Xr,array:rn,bigint:Hr,boolean:ys,date:Wr,discriminatedUnion:cn,effect:_s,enum:yn,function:pn,instanceof:Gr,intersection:ln,lazy:gn,literal:mn,map:hn,nan:Jr,nativeEnum:_n,never:tn,null:Yr,nullable:bn,number:ms,object:nn,oboolean:()=>ys().optional(),onumber:()=>ms().optional(),optional:wn,ostring:()=>gs().optional(),pipeline:Sn,preprocess:kn,promise:vn,record:dn,set:fn,strictObject:an,string:gs,symbol:Kr,transformer:_s,tuple:un,undefined:Qr,union:on,unknown:en,void:sn,NEVER:w,ZodIssueCode:f,quotelessJson:wr,ZodError:F});const Lt=d.object({keywords:d.string().trim().toLowerCase().min(1,"Keyword cannot be empty.").transform(r=>r.replace(/[^\w\s]/g,"")).array().min(1),ignore:d.string().array().optional(),key:d.string(),appearances:d.coerce.number(),response:d.string().trim().min(1,"Response cannot be empty."),fromAutofill:d.boolean().default(!1),question:d.string().optional(),id:d.string().uuid().optional()}),Tn=d.array(Lt),xn=["Bachelor's","Master's","MBA","PhD","PharmD","Associate's","High School","GED","Other"],An=["Afrikaans","Akan","Albanian","Amharic","Arabic","Armenian","Assamese","Azerbaijani","Basque","Belarusian","Bengali","Bhojpuri","Bosnian","Bulgarian","Burmese","Cantonese","Catalan","Cebuano","Chinese","Croatian","Czech","Danish","Dari","Dutch","Dzongkha","English","Estonian","Farsi","Finnish","French","Gaelic","Galician","Georgian","German","Greek","Gujarati","Haitian","Hakka","Hausa","Hebrew","Hiligaynon","Hindi","Hmong","Hungarian","Icelandic","Igbo","Ilokano","Indonesian","Irish","Italian","Japanese","Kannada","Kazakh","Khmer","Kirundi","Konkani","Korean","Kurdish","Kyrgyz","Lao","Latin","Latvian","Lithuanian","Macedonian","Maithili","Malagasy","Malay","Malay/Indonesian","Malayalam","Maltese","Mandarin","Marathi","Marwari","Min Nan","Mongolian","Nepali","Norwegian","Oriya","Pashto","Persian","Polish","Portuguese","Punjabi","Quechua","Romanian","Russian","Serbian","Serbo-Croatian","Shona","Sindhi","Sinhala","Slovak","Slovene","Somali","Spanish","Sundanese","Swahili","Swedish","Tagalog","Tagalog-Filipino","Tajik","Tamil","Telugu","Thai","Tibetan","Turkish","Turkmen","Uighur","Ukrainian","Urdu","Uzbek","Vietnamese","Xhosa","Yoruba","Zulu"],En=["Beginner","Intermediate","Advanced","Full Professional Proficiency","Native"],On=["Male","Female","Non-Binary","I choose not to disclose"],jn=["American Indian or Alaska Native","Asian","Black or African American","Hispanic or Latino","Native Hawaiian or Other Pacific Islander","White","I choose not to disclose"],Pn=["Afghanistan","land Islands","Albania","Algeria","American Samoa","Andorra","Angola","Anguilla","Antigua and Barbuda","Argentina","Armenia","Aruba","Australia","Austria","Azerbaijan","Bahamas","Bahrain","Bangladesh","Barbados","Belarus","Belgium","Belize","Benin","Bermuda","Bhutan","Bolivia","Bonaire, Sint Eustatius, and Saba","Bosnia and Herzegovina","Botswana","Bouvet Island","Brazil","British Indian Ocean Territory","British Virgin Islands","Brunei","Bulgaria","Burkina Faso","Burundi","Cabo Verde","Cambodia","Cameroon","Canada","Cayman Islands","Central African Republic","Chad","Chile","China","Christmas Island","Cocos (Keeling) Islands","Colombia","Comoros","Congo","Congo, Democratic Republic of the","Cook Islands","Costa Rica","Cte d'Ivoire","Croatia","Cuba","Curaao","Cyprus","Czechia","Denmark","Djibouti","Dominica","Dominican Republic","Ecuador","Egypt","El Salvador","Equatorial Guinea","Eritrea","Estonia","Eswatini","Ethiopia","Falkland Islands","Faroe Islands","Fiji","Finland","France","French Guiana","French Polynesia","French Southern Territories","Gabon","Gambia","Georgia","Germany","Ghana","Gibraltar","Greece","Greenland","Grenada","Guadeloupe","Guam","Guatemala","Guernsey","Guinea","Guinea-Bissau","Guyana","Haiti","Heard Island and McDonald Islands","Holy See (Vatican City State)","Honduras","Hong Kong","Hungary","Iceland","India","Indonesia","Iran","Iraq","Ireland","Isle of Man","Israel","Italy","Jamaica","Japan","Jersey","Jordan","Kazakhstan","Kenya","Kiribati","Korea, Democratic People's Republic of","Korea, Republic of","Kosovo","Kuwait","Kyrgyzstan","Laos","Latvia","Lebanon","Lesotho","Liberia","Libya","Liechtenstein","Lithuania","Luxembourg","Macao","Madagascar","Malawi","Malaysia","Maldives","Mali","Malta","Marshall Islands","Martinique","Mauritania","Mauritius","Mayotte","Mexico","Micronesia, Federated States of","Moldova","Monaco","Mongolia","Montenegro","Montserrat","Morocco","Mozambique","Myanmar","Namibia","Nauru","Nepal","Netherlands","New Caledonia","New Zealand","Nicaragua","Niger","Nigeria","Niue","Norfolk Island","Northern Mariana Islands","North Macedonia","Norway","Oman","Pakistan","Palau","Panama","Papua New Guinea","Paraguay","Peru","Philippines","Pitcairn Islands","Poland","Portugal","Puerto Rico","Qatar","Reunion","Romania","Russian Federation","Rwanda","Saint Barthelemy","Saint Helena, Ascension and Tristan da Cunha","Saint Kitts and Nevis","Saint Lucia","Saint Martin","Saint Pierre and Miquelon","Saint Vincent and the Grenadines","Samoa","San Marino","Sao Tome and Principe","Saudi Arabia","Senegal","Serbia","Seychelles","Sierra Leone","Singapore","Sint Maarten","Slovakia","Slovenia","Solomon Islands","Somalia","South Africa","South Georgia and the South Sandwich Islands","South Sudan","Spain","Sri Lanka","State of Palestine","Sudan","Suriname","Svalbard and Jan Mayen","Sweden","Switzerland","Syria","Taiwan","Tajikistan","Tanzania","Thailand","Timor-Leste","Togo","Tokelau","Tonga","Trinidad and Tobago","Tunisia","Trkiye","Turkmenistan","Turks and Caicos Islands","Tuvalu","U. S. Virgin Islands","Uganda","Ukraine","United Arab Emirates","United Kingdom","United States Minor Outlying Islands","United States of America","Uruguay","Uzbekistan","Vanuatu","Venezuela","Vietnam","Wallis and Futuna","Western Sahara","Yemen","Zambia","Zimbabwe"],Cn=d.object({language:d.enum(["",...An]),fluent:d.boolean(),proficiency:d.enum(["",...En])}),Rn=d.object({school:d.string(),degree:d.enum(["",...xn]),fieldOfStudy:d.string(),startDate:d.string().optional(),currentlyAttending:d.boolean(),endDate:d.string().optional(),gpa:d.string().optional()}),In=d.object({jobTitle:d.string(),company:d.string(),location:d.string(),startDate:d.string(),currentlyWorkHere:d.boolean(),endDate:d.string().optional(),description:d.string()}),$n=d.object({line1:d.string(),line2:d.string().optional(),city:d.string(),state:d.string(),postalCode:d.string(),country:d.enum(["",...Pn])}),Ln=d.object({phoneDeviceType:d.string(),phoneCountryCode:d.string(),phoneNumber:d.string(),email:d.string()}),Nn=d.object({prefix:d.string().optional(),firstName:d.string(),middleName:d.string().optional(),lastName:d.string(),suffix:d.string().optional(),preferredName:d.boolean(),preferredFirstName:d.string().optional(),preferredMiddleName:d.string().optional(),preferredLastName:d.string().optional()}),Dn=d.object({websites:d.array(d.string()),github:d.string().optional(),linkedin:d.string().optional(),twitter:d.string().optional(),personal:d.string().optional()}),Un=d.object({resumeBase64:d.string(),fileName:d.string(),fileSize:d.number(),dateUploaded:d.string()}),Mn=d.object({eligibilityUS:d.union([d.boolean(),d.literal("undisclosed")]).optional(),sponsorship:d.union([d.boolean(),d.literal("undisclosed")]).optional(),disability:d.union([d.boolean(),d.literal("undisclosed")]).optional(),veteran:d.union([d.boolean(),d.literal("undisclosed")]).optional(),age:d.union([d.number(),d.literal("undisclosed")]).optional(),gender:d.enum(["",...On]),ethnicity:d.enum(["",...jn])}),Nt=d.object({profileName:d.string().default("Default"),nameData:Nn,addressData:$n,contactData:Ln,jobData:d.array(In),educationData:d.array(Rn),languageData:d.array(Cn),resumeData:Un,websiteData:Dn,employmentData:Mn,skillsData:d.array(d.string()).max(25).optional(),savedResponses:d.preprocess(r=>{Lt.array().safeParse(r).success&&chrome.storage.local.set({responseList:r},()=>chrome.runtime.sendMessage({type:"syncNewResponses",data:r}))},d.undefined())});async function Dt(){return new Promise((r,e)=>{chrome.storage.local.get(["profile"],t=>{try{r(Nt.parse(t.profile))}catch(s){console.error("Error parsing profile:",s),r(void 0)}})})}async function mt(){return new Promise(r=>{chrome.storage.local.get(["lastSyncProfile"],e=>{try{r(d.object({id:d.string().uuid(),lastSync:d.string().datetime({offset:!0})}).optional().parse(e.lastSyncProfile))}catch{r(void 0)}})})}const Ut=d.enum(["applied","screen","interview","offer","rejected","archived"]),Mt=d.object({jobTitle:d.string(),jobLink:d.string(),companyLink:d.string(),companyName:d.string().default(""),date:d.string(),status:Ut.default("applied"),profileName:d.string().default("Default"),id:d.string().uuid().optional()}),Bt=d.array(Mt);d.array(Ut).refine(r=>new Set(r).size===r.length).refine(r=>Object.values(Ut.enum).every(e=>r.includes(e)));const Bn=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Promise.resolve().then(()=>Ie).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)};class Zt extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class Zn extends Zt{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Fn extends Zt{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class zn extends Zt{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Ft;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(Ft||(Ft={}));var qn=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(s.next(u))}catch(h){a(h)}}function c(u){try{l(s.throw(u))}catch(h){a(h)}}function l(u){u.done?i(u.value):n(u.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};class Vn{constructor(e,{headers:t={},customFetch:s,region:n=Ft.Any}={}){this.url=e,this.headers=t,this.region=n,this.fetch=Bn(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return qn(this,void 0,void 0,function*(){try{const{headers:n,method:i,body:a}=t;let o={},{region:c}=t;c||(c=this.region),c&&c!=="any"&&(o["x-region"]=c);let l;a&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob<"u"&&a instanceof Blob||a instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",l=a):typeof a=="string"?(o["Content-Type"]="text/plain",l=a):typeof FormData<"u"&&a instanceof FormData?l=a:(o["Content-Type"]="application/json",l=JSON.stringify(a)));const u=yield this.fetch(`${this.url}/${e}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),n),body:l}).catch(b=>{throw new Zn(b)}),h=u.headers.get("x-relay-error");if(h&&h==="true")throw new Fn(u);if(!u.ok)throw new zn(u);let p=((s=u.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),y;return p==="application/json"?y=yield u.json():p==="application/octet-stream"?y=yield u.blob():p==="text/event-stream"?y=u:p==="multipart/form-data"?y=yield u.formData():y=yield u.text(),{data:y,error:null}}catch(n){return{data:null,error:n}}})}}function vs(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Gn(r){if(Object.prototype.hasOwnProperty.call(r,"__esModule"))return r;var e=r.default;if(typeof e=="function"){var t=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(s){var n=Object.getOwnPropertyDescriptor(r,s);Object.defineProperty(t,s,n.get?n:{enumerable:!0,get:function(){return r[s]}})}),t}var C={},Ee={},Oe={},je={},Pe={},Ce={},Jn=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Re=Jn();const Hn=Re.fetch,ws=Re.fetch.bind(Re),bs=Re.Headers,Wn=Re.Request,Kn=Re.Response,Ie=Object.freeze(Object.defineProperty({__proto__:null,Headers:bs,Request:Wn,Response:Kn,default:ws,fetch:Hn},Symbol.toStringTag,{value:"Module"})),Qn=Gn(Ie);var yt={},ks;function Ss(){if(ks)return yt;ks=1,Object.defineProperty(yt,"__esModule",{value:!0});class r extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return yt.default=r,yt}var Ts;function xs(){if(Ts)return Ce;Ts=1;var r=Ce&&Ce.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Ce,"__esModule",{value:!0});const e=r(Qn),t=r(Ss());class s{constructor(i){this.shouldThrowOnError=!1,this.method=i.method,this.url=i.url,this.headers=i.headers,this.schema=i.schema,this.body=i.body,this.shouldThrowOnError=i.shouldThrowOnError,this.signal=i.signal,this.isMaybeSingle=i.isMaybeSingle,i.fetch?this.fetch=i.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(i,a){return this.headers=Object.assign({},this.headers),this.headers[i]=a,this}then(i,a){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const o=this.fetch;let c=o(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async l=>{var u,h,p;let y=null,b=null,O=null,x=l.status,M=l.statusText;if(l.ok){if(this.method!=="HEAD"){const N=await l.text();N===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?b=N:b=JSON.parse(N))}const $=(u=this.headers.Prefer)===null||u===void 0?void 0:u.match(/count=(exact|planned|estimated)/),L=(h=l.headers.get("content-range"))===null||h===void 0?void 0:h.split("/");$&&L&&L.length>1&&(O=parseInt(L[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(b)&&(b.length>1?(y={code:"PGRST116",details:`Results contain ${b.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},b=null,O=null,x=406,M="Not Acceptable"):b.length===1?b=b[0]:b=null)}else{const $=await l.text();try{y=JSON.parse($),Array.isArray(y)&&l.status===404&&(b=[],y=null,x=200,M="OK")}catch{l.status===404&&$===""?(x=204,M="No Content"):y={message:$}}if(y&&this.isMaybeSingle&&(!((p=y==null?void 0:y.details)===null||p===void 0)&&p.includes("0 rows"))&&(y=null,x=200,M="OK"),y&&this.shouldThrowOnError)throw new t.default(y)}return{error:y,data:b,count:O,status:x,statusText:M}});return this.shouldThrowOnError||(c=c.catch(l=>{var u,h,p;return{error:{message:`${(u=l==null?void 0:l.name)!==null&&u!==void 0?u:"FetchError"}: ${l==null?void 0:l.message}`,details:`${(h=l==null?void 0:l.stack)!==null&&h!==void 0?h:""}`,hint:"",code:`${(p=l==null?void 0:l.code)!==null&&p!==void 0?p:""}`},data:null,count:null,status:0,statusText:""}})),c.then(i,a)}}return Ce.default=s,Ce}var As;function Es(){if(As)return Pe;As=1;var r=Pe&&Pe.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Pe,"__esModule",{value:!0});const e=r(xs());class t extends e.default{select(n){let i=!1;const a=(n??"*").split("").map(o=>/\s/.test(o)&&!i?"":(o==='"'&&(i=!i),o)).join("");return this.url.searchParams.set("select",a),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(n,{ascending:i=!0,nullsFirst:a,foreignTable:o,referencedTable:c=o}={}){const l=c?`${c}.order`:"order",u=this.url.searchParams.get(l);return this.url.searchParams.set(l,`${u?`${u},`:""}${n}.${i?"asc":"desc"}${a===void 0?"":a?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:i,referencedTable:a=i}={}){const o=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(o,`${n}`),this}range(n,i,{foreignTable:a,referencedTable:o=a}={}){const c=typeof o>"u"?"offset":`${o}.offset`,l=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(c,`${n}`),this.url.searchParams.set(l,`${i-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:n=!1,verbose:i=!1,settings:a=!1,buffers:o=!1,wal:c=!1,format:l="text"}={}){var u;const h=[n?"analyze":null,i?"verbose":null,a?"settings":null,o?"buffers":null,c?"wal":null].filter(Boolean).join("|"),p=(u=this.headers.Accept)!==null&&u!==void 0?u:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${l}; for="${p}"; options=${h};`,l==="json"?this:this}rollback(){var n;return((n=this.headers.Prefer)!==null&&n!==void 0?n:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}return Pe.default=t,Pe}var Os;function zt(){if(Os)return je;Os=1;var r=je&&je.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(je,"__esModule",{value:!0});const e=r(Es());class t extends e.default{eq(n,i){return this.url.searchParams.append(n,`eq.${i}`),this}neq(n,i){return this.url.searchParams.append(n,`neq.${i}`),this}gt(n,i){return this.url.searchParams.append(n,`gt.${i}`),this}gte(n,i){return this.url.searchParams.append(n,`gte.${i}`),this}lt(n,i){return this.url.searchParams.append(n,`lt.${i}`),this}lte(n,i){return this.url.searchParams.append(n,`lte.${i}`),this}like(n,i){return this.url.searchParams.append(n,`like.${i}`),this}likeAllOf(n,i){return this.url.searchParams.append(n,`like(all).{${i.join(",")}}`),this}likeAnyOf(n,i){return this.url.searchParams.append(n,`like(any).{${i.join(",")}}`),this}ilike(n,i){return this.url.searchParams.append(n,`ilike.${i}`),this}ilikeAllOf(n,i){return this.url.searchParams.append(n,`ilike(all).{${i.join(",")}}`),this}ilikeAnyOf(n,i){return this.url.searchParams.append(n,`ilike(any).{${i.join(",")}}`),this}is(n,i){return this.url.searchParams.append(n,`is.${i}`),this}in(n,i){const a=Array.from(new Set(i)).map(o=>typeof o=="string"&&new RegExp("[,()]").test(o)?`"${o}"`:`${o}`).join(",");return this.url.searchParams.append(n,`in.(${a})`),this}contains(n,i){return typeof i=="string"?this.url.searchParams.append(n,`cs.${i}`):Array.isArray(i)?this.url.searchParams.append(n,`cs.{${i.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(i)}`),this}containedBy(n,i){return typeof i=="string"?this.url.searchParams.append(n,`cd.${i}`):Array.isArray(i)?this.url.searchParams.append(n,`cd.{${i.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(i)}`),this}rangeGt(n,i){return this.url.searchParams.append(n,`sr.${i}`),this}rangeGte(n,i){return this.url.searchParams.append(n,`nxl.${i}`),this}rangeLt(n,i){return this.url.searchParams.append(n,`sl.${i}`),this}rangeLte(n,i){return this.url.searchParams.append(n,`nxr.${i}`),this}rangeAdjacent(n,i){return this.url.searchParams.append(n,`adj.${i}`),this}overlaps(n,i){return typeof i=="string"?this.url.searchParams.append(n,`ov.${i}`):this.url.searchParams.append(n,`ov.{${i.join(",")}}`),this}textSearch(n,i,{config:a,type:o}={}){let c="";o==="plain"?c="pl":o==="phrase"?c="ph":o==="websearch"&&(c="w");const l=a===void 0?"":`(${a})`;return this.url.searchParams.append(n,`${c}fts${l}.${i}`),this}match(n){return Object.entries(n).forEach(([i,a])=>{this.url.searchParams.append(i,`eq.${a}`)}),this}not(n,i,a){return this.url.searchParams.append(n,`not.${i}.${a}`),this}or(n,{foreignTable:i,referencedTable:a=i}={}){const o=a?`${a}.or`:"or";return this.url.searchParams.append(o,`(${n})`),this}filter(n,i,a){return this.url.searchParams.append(n,`${i}.${a}`),this}}return je.default=t,je}var js;function Ps(){if(js)return Oe;js=1;var r=Oe&&Oe.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Oe,"__esModule",{value:!0});const e=r(zt());class t{constructor(n,{headers:i={},schema:a,fetch:o}){this.url=n,this.headers=i,this.schema=a,this.fetch=o}select(n,{head:i=!1,count:a}={}){const o=i?"HEAD":"GET";let c=!1;const l=(n??"*").split("").map(u=>/\s/.test(u)&&!c?"":(u==='"'&&(c=!c),u)).join("");return this.url.searchParams.set("select",l),a&&(this.headers.Prefer=`count=${a}`),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(n,{count:i,defaultToNull:a=!0}={}){const o="POST",c=[];if(this.headers.Prefer&&c.push(this.headers.Prefer),i&&c.push(`count=${i}`),a||c.push("missing=default"),this.headers.Prefer=c.join(","),Array.isArray(n)){const l=n.reduce((u,h)=>u.concat(Object.keys(h)),[]);if(l.length>0){const u=[...new Set(l)].map(h=>`"${h}"`);this.url.searchParams.set("columns",u.join(","))}}return new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}upsert(n,{onConflict:i,ignoreDuplicates:a=!1,count:o,defaultToNull:c=!0}={}){const l="POST",u=[`resolution=${a?"ignore":"merge"}-duplicates`];if(i!==void 0&&this.url.searchParams.set("on_conflict",i),this.headers.Prefer&&u.push(this.headers.Prefer),o&&u.push(`count=${o}`),c||u.push("missing=default"),this.headers.Prefer=u.join(","),Array.isArray(n)){const h=n.reduce((p,y)=>p.concat(Object.keys(y)),[]);if(h.length>0){const p=[...new Set(h)].map(y=>`"${y}"`);this.url.searchParams.set("columns",p.join(","))}}return new e.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}update(n,{count:i}={}){const a="PATCH",o=[];return this.headers.Prefer&&o.push(this.headers.Prefer),i&&o.push(`count=${i}`),this.headers.Prefer=o.join(","),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}delete({count:n}={}){const i="DELETE",a=[];return n&&a.push(`count=${n}`),this.headers.Prefer&&a.unshift(this.headers.Prefer),this.headers.Prefer=a.join(","),new e.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}return Oe.default=t,Oe}var et={},tt={},Cs;function Yn(){return Cs||(Cs=1,Object.defineProperty(tt,"__esModule",{value:!0}),tt.version=void 0,tt.version="0.0.0-automated"),tt}var Rs;function Xn(){if(Rs)return et;Rs=1,Object.defineProperty(et,"__esModule",{value:!0}),et.DEFAULT_HEADERS=void 0;const r=Yn();return et.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${r.version}`},et}var Is;function ei(){if(Is)return Ee;Is=1;var r=Ee&&Ee.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Ee,"__esModule",{value:!0});const e=r(Ps()),t=r(zt()),s=Xn();class n{constructor(a,{headers:o={},schema:c,fetch:l}={}){this.url=a,this.headers=Object.assign(Object.assign({},s.DEFAULT_HEADERS),o),this.schemaName=c,this.fetch=l}from(a){const o=new URL(`${this.url}/${a}`);return new e.default(o,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(a){return new n(this.url,{headers:this.headers,schema:a,fetch:this.fetch})}rpc(a,o={},{head:c=!1,get:l=!1,count:u}={}){let h;const p=new URL(`${this.url}/rpc/${a}`);let y;c||l?(h=c?"HEAD":"GET",Object.entries(o).filter(([O,x])=>x!==void 0).map(([O,x])=>[O,Array.isArray(x)?`{${x.join(",")}}`:`${x}`]).forEach(([O,x])=>{p.searchParams.append(O,x)})):(h="POST",y=o);const b=Object.assign({},this.headers);return u&&(b.Prefer=`count=${u}`),new t.default({method:h,url:p,headers:b,schema:this.schemaName,body:y,fetch:this.fetch,allowEmpty:!1})}}return Ee.default=n,Ee}var $s;function ti(){if($s)return C;$s=1;var r=C&&C.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(C,"__esModule",{value:!0}),C.PostgrestError=C.PostgrestBuilder=C.PostgrestTransformBuilder=C.PostgrestFilterBuilder=C.PostgrestQueryBuilder=C.PostgrestClient=void 0;const e=r(ei());C.PostgrestClient=e.default;const t=r(Ps());C.PostgrestQueryBuilder=t.default;const s=r(zt());C.PostgrestFilterBuilder=s.default;const n=r(Es());C.PostgrestTransformBuilder=n.default;const i=r(xs());C.PostgrestBuilder=i.default;const a=r(Ss());return C.PostgrestError=a.default,C.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:s.default,PostgrestTransformBuilder:n.default,PostgrestBuilder:i.default,PostgrestError:a.default},C}var si=ti();const ri=vs(si),{PostgrestClient:ni,PostgrestQueryBuilder:ho,PostgrestFilterBuilder:fo,PostgrestTransformBuilder:po,PostgrestBuilder:go,PostgrestError:mo}=ri,ii={"X-Client-Info":"realtime-js/2.11.2"},ai="1.0.0",Ls=1e4,oi=1e3;var $e;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})($e||($e={}));var z;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(z||(z={}));var J;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(J||(J={}));var qt;(function(r){r.websocket="websocket"})(qt||(qt={}));var me;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(me||(me={}));class ci{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const n=t.getUint8(1),i=t.getUint8(2);let a=this.HEADER_LENGTH+2;const o=s.decode(e.slice(a,a+n));a=a+n;const c=s.decode(e.slice(a,a+i));a=a+i;const l=JSON.parse(s.decode(e.slice(a,e.byteLength)));return{ref:null,topic:o,event:c,payload:l}}}class Ns{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var j;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(j||(j={}));const Ds=(r,e,t={})=>{var s;const n=(s=t.skipTypes)!==null&&s!==void 0?s:[];return Object.keys(e).reduce((i,a)=>(i[a]=li(a,r,e,n),i),{})},li=(r,e,t,s)=>{const n=e.find(o=>o.name===r),i=n==null?void 0:n.type,a=t[r];return i&&!s.includes(i)?Us(i,a):Vt(a)},Us=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return fi(e,t)}switch(r){case j.bool:return ui(e);case j.float4:case j.float8:case j.int2:case j.int4:case j.int8:case j.numeric:case j.oid:return di(e);case j.json:case j.jsonb:return hi(e);case j.timestamp:return pi(e);case j.abstime:case j.date:case j.daterange:case j.int4range:case j.int8range:case j.money:case j.reltime:case j.text:case j.time:case j.timestamptz:case j.timetz:case j.tsrange:case j.tstzrange:return Vt(e);default:return Vt(e)}},Vt=r=>r,ui=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},di=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},hi=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},fi=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,s=r[t];if(r[0]==="{"&&s==="}"){let i;const a=r.slice(1,t);try{i=JSON.parse("["+a+"]")}catch{i=a?a.split(","):[]}return i.map(o=>Us(e,o))}return r},pi=r=>typeof r=="string"?r.replace(" ","T"):r,Ms=r=>{let e=r;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class Gt{constructor(e,t,s={},n=Ls){this.channel=e,this.event=t,this.payload=s,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Bs;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(Bs||(Bs={}));class st{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},n=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=st.syncState(this.state,n,i,a),this.pendingDiffs.forEach(c=>{this.state=st.syncDiff(this.state,c,i,a)}),this.pendingDiffs=[],o()}),this.channel._on(s.diff,{},n=>{const{onJoin:i,onLeave:a,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=st.syncDiff(this.state,n,i,a),o())}),this.onJoin((n,i,a)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:i,newPresences:a})}),this.onLeave((n,i,a)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:i,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,n){const i=this.cloneDeep(e),a=this.transformState(t),o={},c={};return this.map(i,(l,u)=>{a[l]||(c[l]=u)}),this.map(a,(l,u)=>{const h=i[l];if(h){const p=u.map(x=>x.presence_ref),y=h.map(x=>x.presence_ref),b=u.filter(x=>y.indexOf(x.presence_ref)<0),O=h.filter(x=>p.indexOf(x.presence_ref)<0);b.length>0&&(o[l]=b),O.length>0&&(c[l]=O)}else o[l]=u}),this.syncDiff(i,{joins:o,leaves:c},s,n)}static syncDiff(e,t,s,n){const{joins:i,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),n||(n=()=>{}),this.map(i,(o,c)=>{var l;const u=(l=e[o])!==null&&l!==void 0?l:[];if(e[o]=this.cloneDeep(c),u.length>0){const h=e[o].map(y=>y.presence_ref),p=u.filter(y=>h.indexOf(y.presence_ref)<0);e[o].unshift(...p)}s(o,u,c)}),this.map(a,(o,c)=>{let l=e[o];if(!l)return;const u=c.map(h=>h.presence_ref);l=l.filter(h=>u.indexOf(h.presence_ref)<0),e[o]=l,n(o,l,c),l.length===0&&delete e[o]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const n=e[s];return"metas"in n?t[s]=n.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[s]=n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Zs;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(Zs||(Zs={}));var Fs;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(Fs||(Fs={}));var se;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(se||(se={}));class Jt{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=z.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Gt(this,J.join,this.params,this.timeout),this.rejoinTimer=new Ns(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=z.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=z.closed,this.socket._remove(this)}),this._onError(n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=z.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=z.errored,this.rejoinTimer.scheduleTimeout())}),this._on(J.reply,{},(n,i)=>{this._trigger(this._replyEventName(i),n)}),this.presence=new st(this),this.broadcastEndpointURL=Ms(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,n;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:i,presence:a,private:o}}=this.params;this._onError(u=>e==null?void 0:e(se.CHANNEL_ERROR,u)),this._onClose(()=>e==null?void 0:e(se.CLOSED));const c={},l={broadcast:i,presence:a,postgres_changes:(n=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(u=>u.filter))!==null&&n!==void 0?n:[],private:o};this.socket.accessTokenValue&&(c.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:l},c)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:u})=>{var h;if(this.socket.setAuth(),u===void 0){e==null||e(se.SUBSCRIBED);return}else{const p=this.bindings.postgres_changes,y=(h=p==null?void 0:p.length)!==null&&h!==void 0?h:0,b=[];for(let O=0;O<y;O++){const x=p[O],{filter:{event:M,schema:Y,table:$,filter:L}}=x,N=u&&u[O];if(N&&N.event===M&&N.schema===Y&&N.table===$&&N.filter===L)b.push(Object.assign(Object.assign({},x),{id:N.id}));else{this.unsubscribe(),e==null||e(se.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=b,e&&e(se.SUBSCRIBED);return}}).receive("error",u=>{e==null||e(se.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(se.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this._on(e,t,s)}async send(e,t={}){var s,n;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:a}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:a,private:this.private}]})};try{const l=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(s=t.timeout)!==null&&s!==void 0?s:this.timeout);return await((n=l.body)===null||n===void 0?void 0:n.cancel()),l.ok?"ok":"error"}catch(l){return l.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var a,o,c;const l=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(o=(a=this.params)===null||a===void 0?void 0:a.config)===null||o===void 0?void 0:o.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),l.receive("ok",()=>i("ok")),l.receive("error",()=>i("error")),l.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=z.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(J.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(s=>{const n=new Gt(this,J.leave,{},e);n.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),n.send(),this._canPush()||n.trigger("ok",{})})}async _fetchWithTimeout(e,t,s){const n=new AbortController,i=setTimeout(()=>n.abort(),s),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(i),a}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new Gt(this,e,t,s);return this._canPush()?n.send():(n.startTimeout(),this.pushBuffer.push(n)),n}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var n,i;const a=e.toLocaleLowerCase(),{close:o,error:c,leave:l,join:u}=J;if(s&&[o,c,l,u].indexOf(a)>=0&&s!==this._joinRef())return;let p=this._onMessage(a,t,s);if(t&&!p)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(y=>{var b,O,x;return((b=y.filter)===null||b===void 0?void 0:b.event)==="*"||((x=(O=y.filter)===null||O===void 0?void 0:O.event)===null||x===void 0?void 0:x.toLocaleLowerCase())===a}).map(y=>y.callback(p,s)):(i=this.bindings[a])===null||i===void 0||i.filter(y=>{var b,O,x,M,Y,$;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in y){const L=y.id,N=(b=y.filter)===null||b===void 0?void 0:b.event;return L&&((O=t.ids)===null||O===void 0?void 0:O.includes(L))&&(N==="*"||(N==null?void 0:N.toLocaleLowerCase())===((x=t.data)===null||x===void 0?void 0:x.type.toLocaleLowerCase()))}else{const L=(Y=(M=y==null?void 0:y.filter)===null||M===void 0?void 0:M.event)===null||Y===void 0?void 0:Y.toLocaleLowerCase();return L==="*"||L===(($=t==null?void 0:t.event)===null||$===void 0?void 0:$.toLocaleLowerCase())}else return y.type.toLocaleLowerCase()===a}).map(y=>{if(typeof p=="object"&&"ids"in p){const b=p.data,{schema:O,table:x,commit_timestamp:M,type:Y,errors:$}=b;p=Object.assign(Object.assign({},{schema:O,table:x,commit_timestamp:M,eventType:Y,new:{},old:{},errors:$}),this._getPayloadRecords(b))}y.callback(p,s)})}_isClosed(){return this.state===z.closed}_isJoined(){return this.state===z.joined}_isJoining(){return this.state===z.joining}_isLeaving(){return this.state===z.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const n=e.toLocaleLowerCase(),i={type:n,filter:t,callback:s};return this.bindings[n]?this.bindings[n].push(i):this.bindings[n]=[i],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter(n=>{var i;return!(((i=n.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===s&&Jt.isEqual(n.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(J.close,{},e)}_onError(e){this._on(J.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=z.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Ds(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Ds(e.columns,e.old_record)),t}}const gi=()=>{},mi=typeof WebSocket<"u",yi=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class _i{constructor(e,t){var s;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=ii,this.params={},this.timeout=Ls,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=gi,this.conn=null,this.sendBuffer=[],this.serializer=new ci,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let a;return i?a=i:typeof fetch>"u"?a=(...o)=>Promise.resolve().then(()=>Ie).then(({default:c})=>c(...o)):a=fetch,(...o)=>a(...o)},this.endPoint=`${e}/${qt.websocket}`,this.httpEndpoint=Ms(e),t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const n=(s=t==null?void 0:t.params)===null||s===void 0?void 0:s.apikey;if(n&&(this.accessTokenValue=n,this.apiKey=n),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(i,a)=>a(JSON.stringify(i)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Ns(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch),t!=null&&t.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(t==null?void 0:t.worker)||!1,this.workerUrl=t==null?void 0:t.workerUrl}this.accessToken=(t==null?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(mi){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new vi(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),Promise.resolve().then(()=>io).then(({default:e})=>{this.conn=new e(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:ai}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case $e.connecting:return me.Connecting;case $e.open:return me.Open;case $e.closing:return me.Closing;default:return me.Closed}}isConnected(){return this.connectionState()===me.Open}channel(e,t={config:{}}){const s=new Jt(`realtime:${e}`,t,this);return this.channels.push(s),s}push(e){const{topic:t,event:s,payload:n,ref:i}=e,a=()=>{this.encode(e,o=>{var c;(c=this.conn)===null||c===void 0||c.send(o)})};this.log("push",`${t} ${s} (${i})`,n),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(t){let s=null;try{s=JSON.parse(atob(t.split(".")[1]))}catch{}if(s&&s.exp&&!(Math.floor(Date.now()/1e3)-s.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${s.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${s.exp}`);this.accessTokenValue=t,this.channels.forEach(n=>{t&&n.updateJoinPayload({access_token:t}),n.joinedOnce&&n._isJoined()&&n._push(J.access_token,{access_token:t})})}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(e=this.conn)===null||e===void 0||e.close(oi,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:s,event:n,payload:i,ref:a}=t;a&&a===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${s} ${n} ${a&&"("+a+")"||""}`,i),this.channels.filter(o=>o._isMember(s)).forEach(o=>o._trigger(n,i,a)),this.stateChangeCallbacks.message.forEach(o=>o(t))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(J.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const s=e.match(/\?/)?"&":"?",n=new URLSearchParams(t);return`${e}${s}${n}`}_workerObjectUrl(e){let t;if(e)t=e;else{const s=new Blob([yi],{type:"application/javascript"});t=URL.createObjectURL(s)}return t}}class vi{constructor(e,t,s){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=$e.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=s.close}}class Ht extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function R(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class wi extends Ht{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Wt extends Ht{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var bi=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(s.next(u))}catch(h){a(h)}}function c(u){try{l(s.throw(u))}catch(h){a(h)}}function l(u){u.done?i(u.value):n(u.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};const zs=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Promise.resolve().then(()=>Ie).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},ki=()=>bi(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Promise.resolve().then(()=>Ie)).Response:Response}),Kt=r=>{if(Array.isArray(r))return r.map(t=>Kt(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,s])=>{const n=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[n]=Kt(s)}),e};var ye=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(s.next(u))}catch(h){a(h)}}function c(u){try{l(s.throw(u))}catch(h){a(h)}}function l(u){u.done?i(u.value):n(u.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};const Qt=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Si=(r,e,t)=>ye(void 0,void 0,void 0,function*(){const s=yield ki();r instanceof s&&!(t!=null&&t.noResolveJson)?r.json().then(n=>{e(new wi(Qt(n),r.status||500))}).catch(n=>{e(new Wt(Qt(n),n))}):e(new Wt(Qt(r),r))}),Ti=(r,e,t,s)=>{const n={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s&&(n.body=JSON.stringify(s)),Object.assign(Object.assign({},n),t))};function rt(r,e,t,s,n,i){return ye(this,void 0,void 0,function*(){return new Promise((a,o)=>{r(t,Ti(e,s,n,i)).then(c=>{if(!c.ok)throw c;return s!=null&&s.noResolveJson?c:c.json()}).then(c=>a(c)).catch(c=>Si(c,o,s))})})}function _t(r,e,t,s){return ye(this,void 0,void 0,function*(){return rt(r,"GET",e,t,s)})}function ce(r,e,t,s,n){return ye(this,void 0,void 0,function*(){return rt(r,"POST",e,s,n,t)})}function xi(r,e,t,s,n){return ye(this,void 0,void 0,function*(){return rt(r,"PUT",e,s,n,t)})}function Ai(r,e,t,s){return ye(this,void 0,void 0,function*(){return rt(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),s)})}function qs(r,e,t,s,n){return ye(this,void 0,void 0,function*(){return rt(r,"DELETE",e,s,n,t)})}var B=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(s.next(u))}catch(h){a(h)}}function c(u){try{l(s.throw(u))}catch(h){a(h)}}function l(u){u.done?i(u.value):n(u.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};const Ei={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Vs={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Oi{constructor(e,t={},s,n){this.url=e,this.headers=t,this.bucketId=s,this.fetch=zs(n)}uploadOrUpdate(e,t,s,n){return B(this,void 0,void 0,function*(){try{let i;const a=Object.assign(Object.assign({},Vs),n);let o=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)});const c=a.metadata;typeof Blob<"u"&&s instanceof Blob?(i=new FormData,i.append("cacheControl",a.cacheControl),c&&i.append("metadata",this.encodeMetadata(c)),i.append("",s)):typeof FormData<"u"&&s instanceof FormData?(i=s,i.append("cacheControl",a.cacheControl),c&&i.append("metadata",this.encodeMetadata(c))):(i=s,o["cache-control"]=`max-age=${a.cacheControl}`,o["content-type"]=a.contentType,c&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),n!=null&&n.headers&&(o=Object.assign(Object.assign({},o),n.headers));const l=this._removeEmptyFolders(t),u=this._getFinalPath(l),h=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:e,body:i,headers:o},a!=null&&a.duplex?{duplex:a.duplex}:{})),p=yield h.json();return h.ok?{data:{path:l,id:p.Id,fullPath:p.Key},error:null}:{data:null,error:p}}catch(i){if(R(i))return{data:null,error:i};throw i}})}upload(e,t,s){return B(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,n){return B(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),a=this._getFinalPath(i),o=new URL(this.url+`/object/upload/sign/${a}`);o.searchParams.set("token",t);try{let c;const l=Object.assign({upsert:Vs.upsert},n),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(l.upsert)});typeof Blob<"u"&&s instanceof Blob?(c=new FormData,c.append("cacheControl",l.cacheControl),c.append("",s)):typeof FormData<"u"&&s instanceof FormData?(c=s,c.append("cacheControl",l.cacheControl)):(c=s,u["cache-control"]=`max-age=${l.cacheControl}`,u["content-type"]=l.contentType);const h=yield this.fetch(o.toString(),{method:"PUT",body:c,headers:u}),p=yield h.json();return h.ok?{data:{path:i,fullPath:p.Key},error:null}:{data:null,error:p}}catch(c){if(R(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,t){return B(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const n=Object.assign({},this.headers);t!=null&&t.upsert&&(n["x-upsert"]="true");const i=yield ce(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:n}),a=new URL(this.url+i.url),o=a.searchParams.get("token");if(!o)throw new Ht("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:o},error:null}}catch(s){if(R(s))return{data:null,error:s};throw s}})}update(e,t,s){return B(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return B(this,void 0,void 0,function*(){try{return{data:yield ce(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(R(n))return{data:null,error:n};throw n}})}copy(e,t,s){return B(this,void 0,void 0,function*(){try{return{data:{path:(yield ce(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(R(n))return{data:null,error:n};throw n}})}createSignedUrl(e,t,s){return B(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),i=yield ce(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:t},s!=null&&s.transform?{transform:s.transform}:{}),{headers:this.headers});const a=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${a}`)},{data:i,error:null}}catch(n){if(R(n))return{data:null,error:n};throw n}})}createSignedUrls(e,t,s){return B(this,void 0,void 0,function*(){try{const n=yield ce(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return{data:n.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${i}`):null})),error:null}}catch(n){if(R(n))return{data:null,error:n};throw n}})}download(e,t){return B(this,void 0,void 0,function*(){const n=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),a=i?`?${i}`:"";try{const o=this._getFinalPath(e);return{data:yield(yield _t(this.fetch,`${this.url}/${n}/${o}${a}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(o){if(R(o))return{data:null,error:o};throw o}})}info(e){return B(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const s=yield _t(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Kt(s),error:null}}catch(s){if(R(s))return{data:null,error:s};throw s}})}exists(e){return B(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield Ai(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(R(s)&&s instanceof Wt){const n=s.originalError;if([400,404].includes(n==null?void 0:n.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),n=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&n.push(i);const o=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});c!==""&&n.push(c);let l=n.join("&");return l!==""&&(l=`?${l}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${s}${l}`)}}}remove(e){return B(this,void 0,void 0,function*(){try{return{data:yield qs(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(R(t))return{data:null,error:t};throw t}})}list(e,t,s){return B(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},Ei),t),{prefix:e||""});return{data:yield ce(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},s),error:null}}catch(n){if(R(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const ji={"X-Client-Info":"storage-js/2.7.1"};var Le=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(s.next(u))}catch(h){a(h)}}function c(u){try{l(s.throw(u))}catch(h){a(h)}}function l(u){u.done?i(u.value):n(u.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};class Pi{constructor(e,t={},s){this.url=e,this.headers=Object.assign(Object.assign({},ji),t),this.fetch=zs(s)}listBuckets(){return Le(this,void 0,void 0,function*(){try{return{data:yield _t(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(R(e))return{data:null,error:e};throw e}})}getBucket(e){return Le(this,void 0,void 0,function*(){try{return{data:yield _t(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(R(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Le(this,void 0,void 0,function*(){try{return{data:yield ce(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(R(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return Le(this,void 0,void 0,function*(){try{return{data:yield xi(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(R(s))return{data:null,error:s};throw s}})}emptyBucket(e){return Le(this,void 0,void 0,function*(){try{return{data:yield ce(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(R(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Le(this,void 0,void 0,function*(){try{return{data:yield qs(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(R(t))return{data:null,error:t};throw t}})}}class Ci extends Pi{constructor(e,t={},s){super(e,t,s)}from(e){return new Oi(this.url,this.headers,e,this.fetch)}}const Ri="2.48.1";let nt="";typeof Deno<"u"?nt="deno":typeof document<"u"?nt="web":typeof navigator<"u"&&navigator.product==="ReactNative"?nt="react-native":nt="node";const Ii={headers:{"X-Client-Info":`supabase-js-${nt}/${Ri}`}},$i={schema:"public"},Li={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Ni={};var Di=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(s.next(u))}catch(h){a(h)}}function c(u){try{l(s.throw(u))}catch(h){a(h)}}function l(u){u.done?i(u.value):n(u.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};const Ui=r=>{let e;return r?e=r:typeof fetch>"u"?e=ws:e=fetch,(...t)=>e(...t)},Mi=()=>typeof Headers>"u"?bs:Headers,Bi=(r,e,t)=>{const s=Ui(t),n=Mi();return(i,a)=>Di(void 0,void 0,void 0,function*(){var o;const c=(o=yield e())!==null&&o!==void 0?o:r;let l=new n(a==null?void 0:a.headers);return l.has("apikey")||l.set("apikey",r),l.has("Authorization")||l.set("Authorization",`Bearer ${c}`),s(i,Object.assign(Object.assign({},a),{headers:l}))})};var Zi=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(s.next(u))}catch(h){a(h)}}function c(u){try{l(s.throw(u))}catch(h){a(h)}}function l(u){u.done?i(u.value):n(u.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};function Fi(r){return r.replace(/\/$/,"")}function zi(r,e){const{db:t,auth:s,realtime:n,global:i}=r,{db:a,auth:o,realtime:c,global:l}=e,u={db:Object.assign(Object.assign({},a),t),auth:Object.assign(Object.assign({},o),s),realtime:Object.assign(Object.assign({},c),n),global:Object.assign(Object.assign({},l),i),accessToken:()=>Zi(this,void 0,void 0,function*(){return""})};return r.accessToken?u.accessToken=r.accessToken:delete u.accessToken,u}const Gs="2.67.3",qi="http://localhost:9999",Vi="supabase.auth.token",Gi={"X-Client-Info":`gotrue-js/${Gs}`},Js=10,Yt="X-Supabase-Api-Version",Hs={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function Ji(r){return Math.round(Date.now()/1e3)+r}function Hi(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}const Q=()=>typeof window<"u"&&typeof document<"u",_e={tested:!1,writable:!1},it=()=>{if(!Q())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(_e.tested)return _e.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),_e.tested=!0,_e.writable=!0}catch{_e.tested=!0,_e.writable=!1}return _e.writable};function Wi(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((n,i)=>{e[i]=n})}catch{}return t.searchParams.forEach((s,n)=>{e[n]=s}),e}const Ws=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Promise.resolve().then(()=>Ie).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},Ki=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",Ks=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},vt=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},wt=async(r,e)=>{await r.removeItem(e)};function Qi(r){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let t="",s,n,i,a,o,c,l,u=0;for(r=r.replace("-","+").replace("_","/");u<r.length;)a=e.indexOf(r.charAt(u++)),o=e.indexOf(r.charAt(u++)),c=e.indexOf(r.charAt(u++)),l=e.indexOf(r.charAt(u++)),s=a<<2|o>>4,n=(o&15)<<4|c>>2,i=(c&3)<<6|l,t=t+String.fromCharCode(s),c!=64&&n!=0&&(t=t+String.fromCharCode(n)),l!=64&&i!=0&&(t=t+String.fromCharCode(i));return t}class bt{constructor(){this.promise=new bt.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}bt.promiseConstructor=Promise;function Qs(r){const e=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,t=r.split(".");if(t.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!e.test(t[1]))throw new Error("JWT is not valid: payload is not in base64url format");const s=t[1];return JSON.parse(Qi(s))}async function Yi(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function Xi(r,e){return new Promise((s,n)=>{(async()=>{for(let i=0;i<1/0;i++)try{const a=await r(i);if(!e(i,null,a)){s(a);return}}catch(a){if(!e(i,a)){n(a);return}}})()})}function ea(r){return("0"+r.toString(16)).substr(-2)}function ta(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length;let n="";for(let i=0;i<56;i++)n+=t.charAt(Math.floor(Math.random()*s));return n}return crypto.getRandomValues(e),Array.from(e,ea).join("")}async function sa(r){const t=new TextEncoder().encode(r),s=await crypto.subtle.digest("SHA-256",t),n=new Uint8Array(s);return Array.from(n).map(i=>String.fromCharCode(i)).join("")}function ra(r){return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function na(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await sa(r);return ra(t)}async function Ne(r,e,t=!1){const s=ta();let n=s;t&&(n+="/PASSWORD_RECOVERY"),await Ks(r,`${e}-code-verifier`,n);const i=await na(s);return[i,s===i?"plain":"s256"]}const ia=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function aa(r){const e=r.headers.get(Yt);if(!e||!e.match(ia))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}class Xt extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function T(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class oa extends Xt{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}function ca(r){return T(r)&&r.name==="AuthApiError"}class Ys extends Xt{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class ve extends Xt{constructor(e,t,s,n){super(e,s,n),this.name=t,this.status=s}}class le extends ve{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function la(r){return T(r)&&r.name==="AuthSessionMissingError"}class es extends ve{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class kt extends ve{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class St extends ve{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function ua(r){return T(r)&&r.name==="AuthImplicitGrantRedirectError"}class Xs extends ve{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ts extends ve{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function ss(r){return T(r)&&r.name==="AuthRetryableFetchError"}class er extends ve{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}var da=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(r);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(r,s[n])&&(t[s[n]]=r[s[n]]);return t};const we=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),ha=[502,503,504];async function tr(r){var e;if(!Ki(r))throw new ts(we(r),0);if(ha.includes(r.status))throw new ts(we(r),r.status);let t;try{t=await r.json()}catch(i){throw new Ys(we(i),i)}let s;const n=aa(r);if(n&&n.getTime()>=Hs["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new er(we(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new le}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,a)=>i&&typeof a=="string",!0))throw new er(we(t),r.status,t.weak_password.reasons);throw new oa(we(t),r.status||500,s)}const fa=(r,e,t,s)=>{const n={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),n.body=JSON.stringify(s),Object.assign(Object.assign({},n),t))};async function A(r,e,t,s){var n;const i=Object.assign({},s==null?void 0:s.headers);i[Yt]||(i[Yt]=Hs["2024-01-01"].name),s!=null&&s.jwt&&(i.Authorization=`Bearer ${s.jwt}`);const a=(n=s==null?void 0:s.query)!==null&&n!==void 0?n:{};s!=null&&s.redirectTo&&(a.redirect_to=s.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",c=await pa(r,e,t+o,{headers:i,noResolveJson:s==null?void 0:s.noResolveJson},{},s==null?void 0:s.body);return s!=null&&s.xform?s==null?void 0:s.xform(c):{data:Object.assign({},c),error:null}}async function pa(r,e,t,s,n,i){const a=fa(e,s,n,i);let o;try{o=await r(t,Object.assign({},a))}catch(c){throw console.error(c),new ts(we(c),0)}if(o.ok||await tr(o),s!=null&&s.noResolveJson)return o;try{return await o.json()}catch(c){await tr(c)}}function ue(r){var e;let t=null;_a(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=Ji(r.expires_in)));const s=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:s},error:null}}function sr(r){const e=ue(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=r.weak_password),e}function de(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function ga(r){return{data:r,error:null}}function ma(r){const{action_link:e,email_otp:t,hashed_token:s,redirect_to:n,verification_type:i}=r,a=da(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:e,email_otp:t,hashed_token:s,redirect_to:n,verification_type:i},c=Object.assign({},a);return{data:{properties:o,user:c},error:null}}function ya(r){return r}function _a(r){return r.access_token&&r.refresh_token&&r.expires_in}var va=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,s=Object.getOwnPropertySymbols(r);n<s.length;n++)e.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(r,s[n])&&(t[s[n]]=r[s[n]]);return t};class wa{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=Ws(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await A(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(T(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await A(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:de})}catch(s){if(T(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=va(e,["options"]),n=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(n.new_email=s==null?void 0:s.newEmail,delete n.newEmail),await A(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:ma,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(T(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await A(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:de})}catch(t){if(T(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,n,i,a,o,c;try{const l={nextPage:null,lastPage:0,total:0},u=await A(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(i=(n=e==null?void 0:e.perPage)===null||n===void 0?void 0:n.toString())!==null&&i!==void 0?i:""},xform:ya});if(u.error)throw u.error;const h=await u.json(),p=(a=u.headers.get("x-total-count"))!==null&&a!==void 0?a:0,y=(c=(o=u.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&c!==void 0?c:[];return y.length>0&&(y.forEach(b=>{const O=parseInt(b.split(";")[0].split("=")[1].substring(0,1)),x=JSON.parse(b.split(";")[1].split("=")[1]);l[`${x}Page`]=O}),l.total=parseInt(p)),{data:Object.assign(Object.assign({},h),l),error:null}}catch(l){if(T(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){try{return await A(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:de})}catch(t){if(T(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){try{return await A(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:de})}catch(s){if(T(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){try{return await A(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:de})}catch(s){if(T(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){try{const{data:t,error:s}=await A(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:t,error:s}}catch(t){if(T(t))return{data:null,error:t};throw t}}async _deleteFactor(e){try{return{data:await A(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(T(t))return{data:null,error:t};throw t}}}const ba={getItem:r=>it()?globalThis.localStorage.getItem(r):null,setItem:(r,e)=>{it()&&globalThis.localStorage.setItem(r,e)},removeItem:r=>{it()&&globalThis.localStorage.removeItem(r)}};function rr(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}function ka(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const De={debug:!!(globalThis&&it()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class nr extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Sa extends nr{}async function Ta(r,e,t){De.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),De.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async n=>{if(n){De.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,n.name);try{return await t()}finally{De.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,n.name)}}else{if(e===0)throw De.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new Sa(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(De.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}ka();const xa={url:qi,storageKey:Vi,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Gi,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},at=30*1e3,ir=3;async function ar(r,e,t){return await t()}class ot{constructor(e){var t,s;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=ot.nextInstanceID,ot.nextInstanceID+=1,this.instanceID>0&&Q()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const n=Object.assign(Object.assign({},xa),e);if(this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new wa({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=Ws(n.fetch),this.lock=n.lock||ar,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:Q()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=Ta:this.lock=ar,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?n.storage?this.storage=n.storage:it()?this.storage=ba:(this.memoryStorage={},this.storage=rr(this.memoryStorage)):(this.memoryStorage={},this.storage=rr(this.memoryStorage)),Q()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Gs}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=Wi(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce"),Q()&&this.detectSessionInUrl&&s!=="none"){const{data:n,error:i}=await this._getSessionFromURL(t,s);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),ua(i)){const c=(e=i.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:a,redirectType:o}=n;return this._debug("#_initialize()","detected session in URL",a,"redirect type",o),await this._saveSession(a),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return T(t)?{error:t}:{error:new Ys("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,n;try{const i=await A(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(n=e==null?void 0:e.options)===null||n===void 0?void 0:n.captchaToken}},xform:ue}),{data:a,error:o}=i;if(o||!a)return{data:{user:null,session:null},error:o};const c=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(i){if(T(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,s,n;try{let i;if("email"in e){const{email:u,password:h,options:p}=e;let y=null,b=null;this.flowType==="pkce"&&([y,b]=await Ne(this.storage,this.storageKey)),i=await A(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:p==null?void 0:p.emailRedirectTo,body:{email:u,password:h,data:(t=p==null?void 0:p.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken},code_challenge:y,code_challenge_method:b},xform:ue})}else if("phone"in e){const{phone:u,password:h,options:p}=e;i=await A(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:h,data:(s=p==null?void 0:p.data)!==null&&s!==void 0?s:{},channel:(n=p==null?void 0:p.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:p==null?void 0:p.captchaToken}},xform:ue})}else throw new kt("You must provide either an email or phone number and a password");const{data:a,error:o}=i;if(o||!a)return{data:{user:null,session:null},error:o};const c=a.session,l=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(i){if(T(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:a,options:o}=e;t=await A(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:sr})}else if("phone"in e){const{phone:i,password:a,options:o}=e;t=await A(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:a,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:sr})}else throw new kt("You must provide either an email or phone number and a password");const{data:s,error:n}=t;return n?{data:{user:null,session:null},error:n}:!s||!s.session||!s.user?{data:{user:null,session:null},error:new es}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:n})}catch(t){if(T(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,n,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){const t=await vt(this.storage,`${this.storageKey}-code-verifier`),[s,n]=(t??"").split("/");try{const{data:i,error:a}=await A(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:ue});if(await wt(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new es}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:n??null}),error:a})}catch(i){if(T(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:s,token:n,access_token:i,nonce:a}=e,o=await A(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:n,access_token:i,nonce:a,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:ue}),{data:c,error:l}=o;return l?{data:{user:null,session:null},error:l}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new es}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:l})}catch(t){if(T(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,n,i,a;try{if("email"in e){const{email:o,options:c}=e;let l=null,u=null;this.flowType==="pkce"&&([l,u]=await Ne(this.storage,this.storageKey));const{error:h}=await A(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(t=c==null?void 0:c.data)!==null&&t!==void 0?t:{},create_user:(s=c==null?void 0:c.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:l,code_challenge_method:u},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:o,options:c}=e,{data:l,error:u}=await A(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(n=c==null?void 0:c.data)!==null&&n!==void 0?n:{},create_user:(i=c==null?void 0:c.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(a=c==null?void 0:c.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:l==null?void 0:l.message_id},error:u}}throw new kt("You must provide either an email or phone number.")}catch(o){if(T(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(e){var t,s;try{let n,i;"options"in e&&(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:a,error:o}=await A(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:n,xform:ue});if(o)throw o;if(!a)throw new Error("An error occurred on token verification.");const c=a.session,l=a.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:l,session:c},error:null}}catch(n){if(T(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithSSO(e){var t,s,n;try{let i=null,a=null;return this.flowType==="pkce"&&([i,a]=await Ne(this.storage,this.storageKey)),await A(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((n=e==null?void 0:e.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:a}),headers:this.headers,xform:ga})}catch(i){if(T(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new le;const{error:n}=await A(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:n}})}catch(e){if(T(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:n,options:i}=e,{error:a}=await A(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){const{phone:s,type:n,options:i}=e,{data:a,error:o}=await A(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:n,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:a==null?void 0:a.message_id},error:o}}throw new kt("You must provide either an email or phone number and a type")}catch(t){if(T(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await vt(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.storage.isServer){let a=this.suppressGetSessionWarning;e=new Proxy(e,{get:(c,l,u)=>(!a&&l==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),a=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,l,u))})}return{data:{session:e},error:null}}const{session:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:n},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await A(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:de}):await this._useSession(async t=>{var s,n,i;const{data:a,error:o}=t;if(o)throw o;return!(!((s=a.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new le}:await A(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(n=a.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0,xform:de})})}catch(t){if(T(t))return la(t)&&(await this._removeSession(),await wt(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:n,error:i}=s;if(i)throw i;if(!n.session)throw new le;const a=n.session;let o=null,c=null;this.flowType==="pkce"&&e.email!=null&&([o,c]=await Ne(this.storage,this.storageKey));const{data:l,error:u}=await A(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:c}),jwt:a.access_token,xform:de});if(u)throw u;return a.user=l.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(s){if(T(s))return{data:{user:null},error:s};throw s}}_decodeJWT(e){return Qs(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new le;const t=Date.now()/1e3;let s=t,n=!0,i=null;const a=Qs(e.access_token);if(a.exp&&(s=a.exp,n=s<=t),n){const{session:o,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!o)return{data:{user:null,session:null},error:null};i=o}else{const{data:o,error:c}=await this._getUser(e.access_token);if(c)throw c;i={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(T(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:a,error:o}=t;if(o)throw o;e=(s=a.session)!==null&&s!==void 0?s:void 0}if(!(e!=null&&e.refresh_token))throw new le;const{session:n,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(T(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!Q())throw new St("No browser detected.");if(e.error||e.error_description||e.error_code)throw new St(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Xs("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new St("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Xs("No code detected.");const{data:Y,error:$}=await this._exchangeCodeForSession(e.code);if($)throw $;const L=new URL(window.location.href);return L.searchParams.delete("code"),window.history.replaceState(window.history.state,"",L.toString()),{data:{session:Y.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:n,access_token:i,refresh_token:a,expires_in:o,expires_at:c,token_type:l}=e;if(!i||!o||!a||!l)throw new St("No session defined in URL");const u=Math.round(Date.now()/1e3),h=parseInt(o);let p=u+h;c&&(p=parseInt(c));const y=p-u;y*1e3<=at&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${y}s, should have been closer to ${h}s`);const b=p-h;u-b>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",b,p,u):u-b<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",b,p,u);const{data:O,error:x}=await this._getUser(i);if(x)throw x;const M={provider_token:s,provider_refresh_token:n,access_token:i,expires_in:h,expires_at:p,refresh_token:a,token_type:l,user:O.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:M,redirectType:e.type},error:null}}catch(s){if(T(s))return{data:{session:null,redirectType:null},error:s};throw s}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await vt(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:n,error:i}=t;if(i)return{error:i};const a=(s=n.session)===null||s===void 0?void 0:s.access_token;if(a){const{error:o}=await this.admin.signOut(a,e);if(o&&!(ca(o)&&(o.status===404||o.status===401||o.status===403)))return{error:o}}return e!=="others"&&(await this._removeSession(),await wt(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=Hi(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,n;try{const{data:{session:i},error:a}=t;if(a)throw a;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let s=null,n=null;this.flowType==="pkce"&&([s,n]=await Ne(this.storage,this.storageKey,!0));try{return await A(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:n,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(T(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(T(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:s,error:n}=await this._useSession(async i=>{var a,o,c,l,u;const{data:h,error:p}=i;if(p)throw p;const y=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await A(this.fetch,"GET",y,{headers:this.headers,jwt:(u=(l=h.session)===null||l===void 0?void 0:l.access_token)!==null&&u!==void 0?u:void 0})});if(n)throw n;return Q()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(s==null?void 0:s.url),{data:{provider:e.provider,url:s==null?void 0:s.url},error:null}}catch(s){if(T(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,n;const{data:i,error:a}=t;if(a)throw a;return await A(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(s=i.session)===null||s===void 0?void 0:s.access_token)!==null&&n!==void 0?n:void 0})})}catch(t){if(T(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await Xi(async n=>(n>0&&await Yi(200*Math.pow(2,n-1)),this._debug(t,"refreshing attempt",n),await A(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:ue})),(n,i)=>{const a=200*Math.pow(2,n);return i&&ss(i)&&Date.now()+a-s<at})}catch(s){if(this._debug(t,"error",s),T(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),Q()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const s=await vt(this.storage,this.storageKey);if(this._debug(t,"session from storage",s),!this._isValidSession(s)){this._debug(t,"session is not valid"),s!==null&&await this._removeSession();return}const n=Math.round(Date.now()/1e3),i=((e=s.expires_at)!==null&&e!==void 0?e:1/0)<n+Js;if(this._debug(t,`session has${i?"":" not"} expired with margin of ${Js}s`),i){if(this.autoRefreshToken&&s.refresh_token){const{error:a}=await this._callRefreshToken(s.refresh_token);a&&(console.error(a),ss(a)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(t,"error",s),console.error(s);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new le;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new bt;const{data:i,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!i.session)throw new le;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const o={session:i.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(i){if(this._debug(n,"error",i),T(i)){const a={session:null,error:i};return ss(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(a),a}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(i),i}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,t,s=!0){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],a=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(e,t)}catch(c){i.push(c)}});if(await Promise.all(a),i.length>0){for(let o=0;o<i.length;o+=1)console.error(i[o]);throw i[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Ks(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await wt(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Q()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),at);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((s.expires_at*1e3-e)/at);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${at}ms, refresh threshold is ${ir} ticks`),n<=ir&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof nr)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Q()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const n=[`provider=${encodeURIComponent(t)}`];if(s!=null&&s.redirectTo&&n.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s!=null&&s.scopes&&n.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[i,a]=await Ne(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(a)}`});n.push(o.toString())}if(s!=null&&s.queryParams){const i=new URLSearchParams(s.queryParams);n.push(i.toString())}return s!=null&&s.skipBrowserRedirect&&n.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;return i?{data:null,error:i}:await A(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(T(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,n;const{data:i,error:a}=t;if(a)return{data:null,error:a};const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:c,error:l}=await A(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token});return l?{data:null,error:l}:(e.factorType==="totp"&&(!((n=c==null?void 0:c.totp)===null||n===void 0)&&n.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(t){if(T(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;if(i)return{data:null,error:i};const{data:a,error:o}=await A(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:o})})}catch(t){if(T(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:n,error:i}=t;return i?{data:null,error:i}:await A(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(T(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=(e==null?void 0:e.factors)||[],n=s.filter(a=>a.factor_type==="totp"&&a.status==="verified"),i=s.filter(a=>a.factor_type==="phone"&&a.status==="verified");return{data:{all:s,totp:n,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;const{data:{session:n},error:i}=e;if(i)return{data:null,error:i};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const a=this._decodeJWT(n.access_token);let o=null;a.aal&&(o=a.aal);let c=o;((s=(t=n.user.factors)===null||t===void 0?void 0:t.filter(h=>h.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(c="aal2");const u=a.amr||[];return{data:{currentLevel:o,nextLevel:c,currentAuthenticationMethods:u},error:null}}))}}ot.nextInstanceID=0;const Aa=ot;class Ea extends Aa{constructor(e){super(e)}}var Oa=function(r,e,t,s){function n(i){return i instanceof t?i:new t(function(a){a(i)})}return new(t||(t=Promise))(function(i,a){function o(u){try{l(s.next(u))}catch(h){a(h)}}function c(u){try{l(s.throw(u))}catch(h){a(h)}}function l(u){u.done?i(u.value):n(u.value).then(o,c)}l((s=s.apply(r,e||[])).next())})};class ja{constructor(e,t,s){var n,i,a;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const o=Fi(e);this.realtimeUrl=`${o}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${o}/auth/v1`,this.storageUrl=`${o}/storage/v1`,this.functionsUrl=`${o}/functions/v1`;const c=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,l={db:$i,realtime:Ni,auth:Object.assign(Object.assign({},Li),{storageKey:c}),global:Ii},u=zi(s??{},l);this.storageKey=(n=u.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(i=u.global.headers)!==null&&i!==void 0?i:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(h,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((a=u.auth)!==null&&a!==void 0?a:{},this.headers,u.global.fetch),this.fetch=Bi(t,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new ni(`${o}/rest/v1`,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),u.accessToken||this._listenForAuthEvents()}get functions(){return new Vn(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Ci(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Oa(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,storageKey:i,flowType:a,lock:o,debug:c},l,u){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Ea({url:this.authUrl,headers:Object.assign(Object.assign({},h),l),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:n,flowType:a,lock:o,debug:c,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new _i(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s==null?void 0:s.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?this.changedAccessToken=s:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const or=((r,e,t)=>new ja(r,e,t))("https://hyeddbbdplkkwyokzqyl.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh5ZWRkYmJkcGxra3d5b2t6cXlsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzA5MDgyNjIsImV4cCI6MjA0NjQ4NDI2Mn0.6GTSsoyXHBTe8Bk5wfuI7cL3SpE7W4eJLIQ7t0v3uXE",{auth:{storage:{getItem:async r=>new Promise(e=>{chrome.storage.local.get([r],t=>{e(t[r]??null)})}),setItem:async(r,e)=>new Promise(t=>{chrome.storage.local.set({[r]:e},()=>{t()})}),removeItem:async r=>new Promise(e=>{chrome.storage.local.remove(r,()=>{e()})})},autoRefreshToken:!1,persistSession:!0,detectSessionInUrl:!0}});async function Z({path:r,requestOptions:e,auth:t=!0,responseSchema:s}){if(e.headers={...e.headers,...e.body instanceof FormData?{}:{"Content-Type":"application/json"},"X-Ext-Version":chrome.runtime.getManifest().version,"X-Ext-Browser":"chrome"},t){const{data:{session:a},error:o}=await or.auth.getSession();if(o||!a)throw new Error("User not authenticated");e.headers={...e.headers,Authorization:`Bearer ${a.access_token}`}}const n=await fetch(`https://www.speedyapply.com${r}`,{...e,credentials:"include"});if(!n.ok)throw new Error(`Request failed: ${n.statusText}`);const i=await n.json();return s?s.parse(i):i}async function U(){const{data:{session:r},error:e}=await or.auth.getSession();return e||!r?null:r}async function Tt(){return new Promise(r=>{chrome.storage.local.get(["appliedList"],e=>{try{r(Bt.parse(e.appliedList))}catch(t){console.error(t),r([])}})})}async function Pa(){return new Promise(r=>{chrome.storage.local.get(["lastSyncAppliedList"],e=>{try{r(d.string().datetime({offset:!0}).optional().parse(e.lastSyncAppliedList))}catch{r(void 0)}})})}async function cr(r,e,t,s="",n=new Date,i=!0){const[a,o]=await Promise.all([Dt(),Tt()]);let c=!1;const l=n.toString();i&&(c=o.some(h=>h.jobTitle===r&&h.jobLink===e&&h.companyLink===t&&h.date.slice(0,15)===l.slice(0,15)&&h.profileName===(a==null?void 0:a.profileName)));const u={jobTitle:r,jobLink:e,companyLink:t,companyName:s,date:l,status:"applied",profileName:(a==null?void 0:a.profileName)||"Default"};c||(o.unshift(u),await chrome.storage.local.set({appliedList:o}),chrome.runtime.sendMessage({type:"syncNewApplication",data:u}))}async function Ca(){if(!await U())return;const[r,e]=await Promise.all([Tt(),mt()]),t=r.filter(a=>!a.id);if(t.length===0)return;const s=100,n=[];for(let a=0;a<t.length;a+=s){const o=t.slice(a,a+s),c=await Z({path:"/api/ext/sync/application",requestOptions:{method:"POST",body:JSON.stringify(o.map(u=>({...u,profileId:e==null?void 0:e.id})))},responseSchema:Mt.extend({id:d.string().uuid()}).array()}),l=o.map(u=>{const h=c.find(p=>p.jobTitle===u.jobTitle&&p.jobLink===u.jobLink&&p.companyLink===u.companyLink&&p.date.slice(0,15)===u.date.slice(0,15)&&p.profileName===u.profileName,u.id===void 0);return h?{...u,id:h.id}:u});n.push(...l)}const i=r.filter(a=>a.id);await chrome.storage.local.set({appliedList:[...n,...i]})}async function Ra(r){if(!await U())return;const e=await mt(),{id:t}=await Z({path:"/api/ext/sync/application",requestOptions:{method:"POST",body:JSON.stringify({profileId:e==null?void 0:e.id,...r})},responseSchema:d.object({id:d.string().uuid()})}),[s,n]=await Promise.all([Dt(),Tt()]),i=n.findIndex(a=>a.jobTitle===r.jobTitle&&a.jobLink===r.jobLink&&a.companyLink===r.companyLink&&a.date.slice(0,15)===r.date.slice(0,15)&&a.profileName===(s==null?void 0:s.profileName)&&a.id===void 0);i!==-1&&(n[i]={...n[i],id:t},chrome.storage.local.set({appliedList:n}))}async function Ia(r){!await U()||!r.id||await Z({path:"/api/ext/sync/application",requestOptions:{method:"PUT",body:JSON.stringify(r)}})}async function $a(r){!await U()||!r||await Z({path:`/api/ext/sync/application?id=${encodeURIComponent(r)}`,requestOptions:{method:"DELETE"}})}async function La(){if(!await U())return[];const r=await Pa(),e=new URLSearchParams;r&&e.set("last_sync",r);const{applications:t,last_sync:s,deleted_ids:n}=await Z({path:`/api/ext/sync/application?${e.toString()}`,requestOptions:{method:"GET"},responseSchema:d.object({applications:Mt.extend({id:d.string().uuid()}).array(),deleted_ids:d.string().uuid().array(),last_sync:d.string().datetime({offset:!0}).optional()})});if(t.length===0&&n.length===0)return[];const i=await Tt(),a=t.filter(l=>!i.some(u=>u.id===l.id)),o=i.map(l=>{const u=t.find(h=>h.id===l.id);return u?{...l,...u}:l}),c=[...a,...o].filter(l=>l.id&&!n.includes(l.id));return await chrome.storage.local.set({appliedList:c}),s&&await chrome.storage.local.set({lastSyncAppliedList:s}),c}async function xt(){return new Promise(r=>{chrome.storage.local.get(["responseList"],e=>{try{r(Tn.parse(e.responseList))}catch(t){console.error(t),r([])}})})}async function Na(){return new Promise(r=>{chrome.storage.local.get(["lastSyncResponseList"],e=>{try{r(d.string().datetime({offset:!0}).optional().parse(e.lastSyncResponseList))}catch{r(void 0)}})})}function Da(r){const e=r.match(/\b\w+\b/g),t=e?new Set(e.map(s=>s.toLowerCase()).filter(s=>(s.length>1||!isNaN(Number(s)))&&!Ua.includes(s))):new Set;return Array.from(t)}const Ua=["am","an","as","at","be","by","co","do","eg","et","ex","go","he","hi","ie","if","in","is","it","me","mr","my","nd","of","oh","ok","on","or","qv","rd","re","so","th","to","un","up","us","vs","we"];async function Ma(r){const e=await xt(),t={};for(const i of e)t[i.key]=i;const s=[],n=[];for(const{question:i,response:a}of r){if(/^(select|choose|please select|\-\-)(\s(all|one))?\.*$/i.test(a))continue;const o=Da(i);if(!o.length)continue;const c=o.sort().join("|"),l=t[c];if(l)l.response=a,l.fromAutofill=!0,n.push(l);else{const u={keywords:o,key:c,appearances:o.length,response:a,fromAutofill:!0,question:i};e.push(u),t[c]=u,s.push(u)}}await chrome.storage.local.set({responseList:e}),await At(s),await lr(n)}async function At(r){if(!await U())return;const e=r===void 0?await xt():r,t=e.filter(i=>!i.id);if(t.length===0)return;const s=100,n=[];for(let i=0;i<t.length;i+=s){const a=t.slice(i,i+s),o=await Z({path:"/api/ext/sync/response",requestOptions:{method:"POST",body:JSON.stringify(a)},responseSchema:d.object({id:d.string().uuid(),key:d.string()}).array()}),c=a.map(l=>{const u=o.find(h=>h.key===l.key&&l.id===void 0);return u?{...l,id:u.id}:l});n.push(...c)}if(r===void 0){const i=e.filter(a=>a.id);await chrome.storage.local.set({responseList:[...n,...i]})}else{const a=(await xt()).map(o=>{const c=n.find(l=>l.key===o.key);return c?{...o,...c}:o});await chrome.storage.local.set({responseList:a})}}async function lr(r){const e=r.filter(t=>typeof t.id=="string");!await U()||e.length===0||await Z({path:"/api/ext/sync/response",requestOptions:{method:"PUT",body:JSON.stringify(e)}})}async function Ba(r){!await U()||!r||await Z({path:`/api/ext/sync/response?id=${encodeURIComponent(r)}`,requestOptions:{method:"DELETE"}})}async function ur(){await U()&&await Z({path:"/api/ext/sync/response?delete_all=true",requestOptions:{method:"DELETE"}})}async function Za(r){await ur(),await At(r)}async function Fa(){if(!await U())return[];const r=await Na(),e=new URLSearchParams;r&&e.set("last_sync",r);const{responses:t,last_sync:s,deleted_ids:n}=await Z({path:`/api/ext/sync/response?${e.toString()}`,requestOptions:{method:"GET"},responseSchema:d.object({responses:Lt.extend({id:d.string().uuid()}).array(),deleted_ids:d.string().uuid().array(),last_sync:d.string().datetime({offset:!0}).optional()})});if(t.length===0&&n.length===0)return[];const i=await xt(),a=t.filter(l=>!i.some(u=>u.id===l.id)),o=i.map(l=>{const u=t.find(h=>h.id===l.id);return u?{...l,...u}:l}),c=[...a,...o].filter(l=>l.id&&!n.includes(l.id));return await chrome.storage.local.set({responseList:c}),s&&await chrome.storage.local.set({lastSyncResponseList:s}),c}const re={configName:"Default",autofillSettings:{saveApplications:!0,autoClickNextPage:!1,autoSubmit:!1,saveResponses:!0}},Et={accountEmail:"",accountPassword:"",useProfileEmail:!1};async function za(r){const e=Bt.safeParse(r.newValue),t=Bt.safeParse(r.oldValue);if(!e.success||!t.success||e.data.length===t.data.length)return;const s=await chrome.tabs.query({url:["*://github.com/speedyapply/2025-SWE-College-Jobs*","*://github.com/speedyapply/2025-AI-College-Jobs*","*://github.com/speedyapply/2026-SWE-College-Jobs*","*://github.com/speedyapply/2026-AI-College-Jobs*"]});for(const n of s)try{n.id!==void 0&&await chrome.tabs.sendMessage(n.id,{action:"runAddCheckmarks"})}catch{console.log(`Error sending message to tab ${n.id}:`)}}async function qa(){const[r,e]=await Promise.all([Va(),new Promise(t=>{chrome.storage.local.get(["profile"],s=>t(Nt.safeParse(s.profile).success))})]);!r&&e&&await dr()}async function dr(){const[r,e]=await Promise.all([Dt(),mt()]);if(!await U()||!r)return;const{id:t,last_sync:s}=await Z({path:"/api/ext/sync/profile",requestOptions:{method:"POST",body:JSON.stringify({id:e==null?void 0:e.id,profile:r})},responseSchema:d.object({id:d.string().uuid(),last_sync:d.string().datetime({offset:!0})})});await chrome.storage.local.set({lastSyncProfile:{id:t,lastSync:s}})}async function Va(){if(!await U())return null;const r=await mt(),e=new URLSearchParams;r!=null&&r.id&&e.set("id",r.id),r!=null&&r.lastSync&&e.set("last_sync",r.lastSync);const t=await Z({path:`/api/ext/sync/profile?${e.toString()}`,requestOptions:{method:"GET"},responseSchema:d.union([d.object({profile:Nt,id:d.string().uuid(),last_sync:d.string().datetime({offset:!0})}),d.object({}).strict()])});return"profile"in t?(await chrome.storage.local.set({profile:t.profile,lastSyncProfile:{id:t.id,lastSync:t.last_sync}}),t.profile):null}const rs=d.object({accountEmail:d.string().trim(),accountPassword:d.string().trim(),useProfileEmail:d.boolean()}),Ga=d.object({saveApplications:d.boolean(),autoClickNextPage:d.boolean(),autoSubmit:d.boolean(),saveResponses:d.preprocess(r=>r===void 0?!0:r,d.boolean())}),hr=d.object({configName:d.string().optional(),autofillSettings:Ga,accountSettings:d.preprocess(r=>{const e=rs.extend({useProfileEmail:d.boolean().optional()}).safeParse(r);e.success&&chrome.storage.local.set({autofillAccount:{...e.data,useProfileEmail:e.data.useProfileEmail??!1}})},d.undefined())}),fr=d.array(hr.extend({configName:d.string()})),Ja=d.number().min(1).max(999);async function Ha(){return new Promise(r=>{chrome.storage.local.get(["settings","configList"],e=>{try{r({settings:hr.parse(e.settings),configList:fr.parse(e.configList)})}catch(t){console.error(t),chrome.storage.local.set({settings:re,configList:[re]}),r({settings:re,configList:[re]})}})})}async function Wa(){return new Promise(r=>{chrome.storage.local.get(["dailyGoal"],e=>{try{r(Ja.parse(e.dailyGoal))}catch(t){console.error(t),chrome.storage.local.set({dailyGoal:10}).then(()=>r(10))}})})}async function Ka(){return new Promise(r=>{chrome.storage.local.get(["autofillAccount"],e=>{try{r(rs.parse(e.autofillAccount))}catch(t){console.error(t),chrome.storage.local.set({autofillAccount:Et}).then(()=>r(Et))}})})}async function pr(){return new Promise(r=>{chrome.storage.local.get(["lastSyncSettings"],e=>{try{r(d.object({id:d.string().uuid(),lastSync:d.string().datetime({offset:!0})}).optional().parse(e.lastSyncSettings))}catch{r(void 0)}})})}async function Qa(){if(!await U())return;await Ya()||await gr()}async function gr(){if(!await U())return;const[r,e,t,s]=await Promise.all([Ha(),Wa(),Ka(),pr()]),{id:n,last_sync:i}=await Z({path:"/api/ext/sync/settings",requestOptions:{method:"POST",body:JSON.stringify({id:s==null?void 0:s.id,config_list:r.configList,active_config:r.settings.configName??"Default",daily_goal:e,autofill_account:t})},responseSchema:d.object({id:d.string().uuid(),last_sync:d.string().datetime({offset:!0})})});await chrome.storage.local.set({lastSyncSettings:{id:n,lastSync:i}})}async function Ya(){if(!await U())return null;const r=await pr(),e=new URLSearchParams;r!=null&&r.id&&e.set("id",r.id),r!=null&&r.lastSync&&e.set("last_sync",r.lastSync);const t=await Z({path:`/api/ext/sync/settings?${e.toString()}`,requestOptions:{method:"GET"},responseSchema:d.union([d.object({config_list:fr,daily_goal:d.number(),active_config:d.string(),autofill_account:rs,id:d.string().uuid(),last_sync:d.string().datetime({offset:!0})}),d.object({}).strict()])});return"config_list"in t?(await chrome.storage.local.set({configList:t.config_list,settings:t.config_list.find(s=>s.configName===t.active_config)??re,dailyGoal:t.daily_goal,autofillAccount:t.autofill_account,lastSyncSettings:{id:t.id,lastSync:t.last_sync}}),t.config_list):null}async function Xa(r){const e=r.oldValue!==null&&r.oldValue!==void 0,t=r.newValue!==null&&r.newValue!==void 0;!e&&t?(chrome.runtime.sendMessage({type:"userLoggedIn"}),await qa(),await Promise.all([Ca(),At(),Qa()]),await Promise.all([La(),Fa()]),await chrome.storage.local.set({initialSyncComplete:!0})):e&&!t&&chrome.storage.local.clear(()=>{chrome.storage.local.set({autofillEnabled:!0,settings:re,configList:[re],autofillAccount:Et,appliedList:[],responseList:[],dailyGoal:10,initialSyncComplete:!1})})}const eo=vr(()=>{chrome.runtime.onInstalled.addListener(async e=>{if(e.reason===chrome.runtime.OnInstalledReason.INSTALL){chrome.runtime.setUninstallURL("https://www.speedyapply.com/uninstall");const t=chrome.runtime.getURL("/options.html#/edit");await chrome.tabs.create({url:t}),chrome.storage.local.set({autofillEnabled:!0,settings:re,configList:[re],autofillAccount:Et,appliedList:[],responseList:[],dailyGoal:10,initialSyncComplete:!1})}else if(e.reason===chrome.runtime.OnInstalledReason.UPDATE){const t=await chrome.storage.local.get(),s=Object.keys(t).find(n=>n.startsWith("sb-")&&n.endsWith("-auth-token"));await chrome.storage.local.set({initialSyncComplete:!!s&&!!t[s]})}r()}),chrome.storage.onChanged.addListener(async function(e,t){const s=Object.keys(e).find(n=>n.startsWith("sb-")&&n.endsWith("-auth-token"));if(t==="local"&&s){await Xa(e[s]);return}else if(t==="local"&&e.appliedList){za(e.appliedList);return}}),chrome.runtime.onMessage.addListener(e=>{switch(e.type){case"syncNewApplication":Ra(e.data);break;case"syncUpdatedApplication":Ia(e.data);break;case"syncDeletedApplication":$a(e.data);break;case"saveResponses":Ma(e.data);break;case"syncNewResponses":At(e.data);break;case"syncUpdatedResponses":lr(e.data);break;case"syncDeletedResponse":Ba(e.data);break;case"syncDeleteAllResponses":ur();break;case"overwriteResponses":Za(e.data);break;case"syncProfile":dr();break;case"syncSettings":gr();break;default:console.warn(`Unhandled message type: ${e.type}`)}return!0});function r(){chrome.contextMenus.removeAll(()=>{chrome.contextMenus.create({id:"link-save-application",title:"Save Link as Application",contexts:["link"]}),chrome.contextMenus.create({id:"page-save-application",title:"Save Page as Application",contexts:["page"]})})}chrome.contextMenus.onClicked.addListener(async(e,t)=>{switch(e.menuItemId){case"link-save-application":try{const s=e.linkUrl;if(!s)return;const a=(await(await fetch(s)).text()).match(/<title.*?>(.*?)<\/title>/i),o=a?a[1]:"";await cr(o,s,"")}catch(s){console.error("Error fetching page content:",s)}break;case"page-save-application":await cr((t==null?void 0:t.title)??"",e.pageUrl,"");break}})});function ko(){}(_r=(yr=globalThis.browser)==null?void 0:yr.runtime)!=null&&_r.id?globalThis.browser:globalThis.chrome;function Ot(r,...e){}const to={debug:(...r)=>Ot(console.debug,...r),log:(...r)=>Ot(console.log,...r),warn:(...r)=>Ot(console.warn,...r),error:(...r)=>Ot(console.error,...r)};let ns;try{ns=eo.main(),ns instanceof Promise&&console.warn("The background's main() function return a promise, but it must be synchronous")}catch(r){throw to.error("The background crashed on startup!"),r}const so=ns;var is,mr;function ro(){return mr||(mr=1,is=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}),is}var no=ro();const io=Object.freeze(Object.defineProperty({__proto__:null,default:vs(no)},Symbol.toStringTag,{value:"Module"}));return so}();
background;
